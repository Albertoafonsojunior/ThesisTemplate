\chapter{Kinetic equation}
\section{Introduction}
After we perform a Pauli-decomposition, the part of the Usadel equation describing the nonequilibrium distribution function~$\BC{H}$ -- also known as the \emph{kinetic equation} -- can be written [Eq.~(12) in our arXiv manuscript]:
\begin{equation}
  \BC{U} = -\partial_z \BC{J}
\end{equation}
Meanwhile, the nonequilibrium matrix current becomes [Eq.~(21)]:
\begin{equation}
  \BC{J} = \BC{M}\partial_z\BC{H} + \BC{Q}\BC{H}
\end{equation}
Substituting the latter into the former we get [Eq.~(39)]:
\begin{equation}
  \BC{M} \partial_z^2 \BC{H} = -\big[ (\partial_z\BC{M}) + \BC{Q} \big] \partial_z \BC{H} - (\partial_z \BC{Q}) \BC{H} - \BC{U}
\end{equation}
What I will show here, is that we can in general write $\BC{U} = \BC{K} \BC{H}$, so that:
\begin{equation}
  \BC{M} \partial_z^2 \BC{H} = -\big[ (\partial_z\BC{M}) + \BC{Q} \big] \partial_z \BC{H} - \big[ (\partial_z \BC{Q}) + \BC{K} \big] \BC{H}
\end{equation}
If we then define the quantities:
\begin{align}
  \BC{C}_1 &= -\BC{M}^{-1} \big[ (\partial_z\BC{M}) + \BC{Q} \big] \\
  \BC{C}_2 &= -\BC{M}^{-1} \big[ \, (\partial_z\BC{Q}) \,+ \BC{K} \big]
\end{align}
Then the kinetic equation can be written simply as:
\begin{equation}
  \partial_z^2 \BC{H} = \BC{C}_1 \partial_z \BC{H} + \BC{C}_2 \BC{H}
\end{equation}
Here, the matrices $\BC{C}_1$ and $\BC{C}_2$ are determined solely by equilibrium properties, and thus can be considered constants when solving the nonequilibrium equation above.
This should make this form of the equation very efficient to solve, since it is an \emph{explicit and linear differential equation}.

\clearpage
\section{First-order terms}
First, I will look at terms which are first-order in the $8\times8$ propagator~$\UV{G}$.
Before Pauli-decomposition, the Usadel equation for such terms look like
\begin{equation}
  iD \partial_z(\UV{G} \partial_z \UV{G}) = \big[ \UV{\Sigma}, \UV{G} \big],
\end{equation}
where I first assume that $\UV{\Sigma}$ is independent of $\UV{G}$, making the right-hand side above first-order in $\UV{G}$.
Upon introducing $\UV{I} \sim \UV{G} \partial_z \UV{G}$ and $\UV{U} \sim \big[ \UV{\Sigma}, \UV{G} \big]$, we get
\begin{equation}
  \partial_z \UV{I} = \UV{U}.
\end{equation}
Writing out the Keldysh-space structure, the potential $\UV{U}$ becomes
\begin{align}
  \UV{U} &=
    \begin{pmatrix}
      \U\Sigma & 0 \\[0.5ex]
      0 & \U\Sigma
    \end{pmatrix}
    \begin{pmatrix}
      {\U G}^R & {\U G}^K \\[0.5ex]
      0        & {\U G}^A
    \end{pmatrix}
    -
    \begin{pmatrix}
      {\U G}^R & {\U G}^K \\[0.5ex]
      0        & {\U G}^A
    \end{pmatrix}
    \begin{pmatrix}
      \U\Sigma & 0 \\[0.5ex]
      0 & \U\Sigma
    \end{pmatrix}
  \\ &=
    \begin{pmatrix}
      \big[{\U\Sigma}\big, {\U G}^R] & \big[{\U\Sigma}, {\U G}^K\big] \\[1ex]
      0        & \big[{\U\Sigma}, {\U G}^A\big]
    \end{pmatrix}
\end{align}
In other words, as long as the self-energy is diagonal in Keldysh space, the Keldysh component of the matrix potential is simply
\begin{equation}
  {\U U}^K = \big[ {\U\Sigma}, {\U G}^K \big] .
\end{equation}
Now, the Pauli-decompositions of the Kelydysh components were:
\begin{align}
  \C{J}_i & \equiv \frac{1}{4} \tr\left\{ {\U \rho_i} {\U I}^K \right\}, &
  \C{U}_i & \equiv \frac{1}{4} \tr\left\{ {\U \rho_i} {\U U}^K \right\}.
\end{align}
Using the above equation for ${\U U}^K$ and the cyclic rule for traces:
\begin{align}
  \C{U}_i 
  &= \frac{1}{4} \tr\left\{ {\U \rho_i} \big[ {\U\Sigma}, {\U G}^K\big] \right\} \\
  &= \frac{1}{4} \tr\left\{ {\U \rho_i} \big[ {\U\Sigma} {\U G}^K - {\U G}^K {\U\Sigma} \big] \right\} \\
  &= \frac{1}{4} \tr\left\{ {\U \rho_i} {\U\Sigma} {\U G}^K - {\U\Sigma} {\U \rho_i} {\U G}^K \right\} \\
  &= \frac{1}{4} \tr\left\{ \big[{\U \rho_i}, {\U\Sigma}\big] {\U G}^K \right\}.
\end{align}
Inserting ${\U G}^K = {\U G}^R {\U H} - {\U H} {\U G}^A$:
\begin{align}
  \C{U}_i 
  &= \frac{1}{4} \tr\left\{ \big[{\U \rho_i}, {\U\Sigma}\big] {\U G}^R {\U H} - \big[{\U \rho_i}, {\U\Sigma}\big] {\U H} {\U G}^A \right\} \\
  &= \frac{1}{4} \tr\left\{ \big[{\U \rho_i}, {\U\Sigma}\big] {\U G}^R {\U H} - {\U G}^A \big[{\U \rho_i}, {\U\Sigma}\big] {\U H} \right\}.
\end{align}
As we did for the Pauli-decomposition of the current and potential, we can insert $\U H = \sum_j \C{H}_j {\U \rho}_j$, and move the scalar coefficients $\C{H}_j$ and summation out of the trace.
What we find then, is that the equation above can be written
\begin{align}
  \C{U}_i = \sum_j \C{K}_{ij} \C{H}_j,
\end{align}
where we define the new matrix coefficient
\begin{align}
  \C{K}_{ij}
  &= \frac{1}{4} \tr\left\{ \big[{\U \rho_i}, {\U\Sigma}\big] {\U G}^R {\U \rho}_j - {\U G}^A \big[{\U \rho_i}, {\U\Sigma}\big] {\U \rho}_j \right\}.
\end{align}
There are two things to note about this result.
First, this equation makes it almost trivial to specify the Usadel equation for new materials, since it is a direct function of the self-energy $\U \Sigma$ that we would put into the Usadel equation itself.
Second, the matrix $\U \Sigma$ is just filled with system parameters that we set (energy, exchange field, etc.), while the matrices ${\U G}^R$ and ${\U G}^A$ only depend on the equilibrium solution.
Since this matrix is completely independent of the nonequilibrium distribution $\BC H$, we can precalculate it before solving the differential equation, and do not have to evaluate it more than once per energy and position.



\section{Second-order terms}
Above, we considered a matrix potential $\V{U} = \big[\V{\Sigma}, \V{G}\big]$ where $\V{\Sigma}$ assumed to be independent of $\V{G}$.
This is sufficient for a lot of systems (e.g. normal metals, ferromagnets, even half-metals), but not completely general.
There are at least three exceptions I know of based on the projects I've worked on so far:\\[1ex]
\begin{tabular}{ll}
  Spin-flip scattering: &
  $\V{U} \sim \big[ \tau_3 \BU{\sigma} \V{G} \BU{\sigma} \tau_3, \V{G} \big];$ \\[0.5ex]
  Spin-orbit scattering: &
  $\V{U} \sim \big[ \phantom{\tau_3}\BU{\sigma} \V{G} \BU{\sigma} \phantom{\tau_3}, \V{G} \big];$ \\[0.5ex]
  Orbital depairing: & 
  $\V{U} \sim \big[  \tau_3 \phantom{\BU{\sigma}}\V{G} \phantom{\BU{\sigma}} \tau_3 , \V{G} \big]$.\\[1ex]
\end{tabular}

\noindent
Note that all of the above are second-order in the propagator~$\V{G}$, and has the same basic structure $\V{U} = \big[ \V{\Sigma} \V{G} \V{\Sigma}, \V{G} \big]$.
The matrix $\V{\Sigma}$ in this expression is again diagonal in Keldysh space and independent of the propagator $\V{G}$.
Let us now check what happens if we assume such a form for the potential~$\V{U}$:
\begin{align*}
  \UV{U}
  &=
    \big[ \V{\Sigma} \V{G} \V{\Sigma}, \V{G} \big] 
  \\ &=
    \begin{pmatrix}
      {\U\Sigma} {\U G}^R {\U\Sigma} &
      {\U\Sigma} {\U G}^K {\U\Sigma} \\
      0                              &
      {\U\Sigma} {\U G}^A {\U\Sigma} 
    \end{pmatrix}
    \begin{pmatrix}
      {\U G}^R & {\U G}^K \\[0.5ex]
      0        & {\U G}^A
    \end{pmatrix}
    -
    \begin{pmatrix}
      {\U G}^R & {\U G}^K \\[0.5ex]
      0        & {\U G}^A
    \end{pmatrix}
    \begin{pmatrix}
      {\U\Sigma} {\U G}^R {\U\Sigma} &
      {\U\Sigma} {\U G}^K {\U\Sigma} \\
      0                              &
      {\U\Sigma} {\U G}^A {\U\Sigma} 
    \end{pmatrix}
  \\ &=
    \begin{pmatrix}
      \big[{\U\Sigma} {\U G}^R {\U\Sigma}\big, {\U G}^R] & 
      {\U\Sigma} {\U G}^R {\U\Sigma} {\U G}^K            +
      {\U\Sigma} {\U G}^K {\U\Sigma} {\U G}^A            - 
      {\U G}^R {\U\Sigma} {\U G}^K {\U\Sigma}            -
      {\U G}^K {\U\Sigma} {\U G}^A {\U\Sigma}            \\[1ex]
      0                                                  &
      \big[{\U\Sigma} {\U G}^A {\U\Sigma}, {\U G}^A\big]
    \end{pmatrix}
\end{align*} 
In other words, the Keldysh component takes the more complicated form:
\begin{equation}
  \U{U}^K = 
      {\U\Sigma} {\U G}^R {\U\Sigma} {\U G}^K +
      {\U\Sigma} {\U G}^K {\U\Sigma} {\U G}^A - 
      {\U G}^R {\U\Sigma} {\U G}^K {\U\Sigma} -
      {\U G}^K {\U\Sigma} {\U G}^A {\U\Sigma} .
\end{equation}
Like before, we can multiply by ${\U\rho}_i$ and trace to obtain the Pauli-decomposition, then use the cyclic trace rule and reorder the terms a bit:
\begin{align*}
  \C{U}_i
  &= 
    \frac{1}{4}
    \tr 
    \left\{
      {\U\rho}_i {\U\Sigma} {\U G}^R {\U\Sigma} {\U G}^K +
      {\U\rho}_i {\U\Sigma} {\U G}^K {\U\Sigma} {\U G}^A - 
      {\U\rho}_i {\U G}^R {\U\Sigma} {\U G}^K {\U\Sigma} -
      {\U\rho}_i {\U G}^K {\U\Sigma} {\U G}^A {\U\Sigma} 
    \right\}
  \\ 
  &= 
    \frac{1}{4}
    \tr 
    \left\{
      {\U\rho}_i {\U\Sigma} {\U G}^R {\U\Sigma} {\U G}^K +
      {\U\Sigma} {\U G}^A {\U\rho}_i {\U\Sigma} {\U G}^K - 
      {\U\Sigma} {\U\rho}_i {\U G}^R {\U\Sigma} {\U G}^K -
      {\U\Sigma} {\U G}^A {\U\Sigma} {\U\rho}_i {\U G}^K 
    \right\}
  \\ 
  &= 
    \frac{1}{4}
    \tr 
    \left\{
      \big[ {\U\rho}_i, {\U\Sigma} \big] {\U G}^R {\U\Sigma} {\U G}^K +
      {\U\Sigma} {\U G}^A \big[ {\U\rho}_i, {\U\Sigma} \big] {\U G}^K 
    \right\}
\end{align*}
For simplicity, let's write this in the following form for now:
\begin{align}
  \C{U}_i
  &= 
    \frac{1}{4} \tr \left\{ \U F_i {\U G}^K \right\}
  ,
  &
  \U F_i
  = \big[ {\U\rho}_i, {\U\Sigma} \big] {\U G}^R {\U\Sigma} 
  + {\U\Sigma} {\U G}^A \big[ {\U\rho}_i, {\U\Sigma} \big]
  .
\end{align}
We then substitute in ${\U G}^K = {\U G}^R {\U H} - {\U H} {\U G}^A$:
\begin{align}
  \C{U}_i
  = 
    \frac{1}{4}
    \tr 
    \left\{
      {\U F}_i {\U G}^R {\U H} -
      {\U F}_i {\U H} {\U G}^A 
    \right\}
  = 
    \frac{1}{4}
    \tr 
    \left\{
      {\U F}_i {\U G}^R {\U H} -
      {\U G}^A {\U F}_i {\U H}
    \right\}
\end{align}
We then use $\U H = \sum_j H_j {\U\rho}_j$ to write the above equation as:
\begin{align}
  \C{U}_i    &= \sum_j \C{K}_{ij} \C{H}_j, &
  \C{K}_{ij} &= \frac{1}{4} \tr \left\{ {\U F}_i {\U G}^R {\U\rho}_j - {\U G}^A {\U F}_i {\U \rho}_j \right\}.
\end{align}
We could substitute back the definition of ${\U F}_i$ to see the explicit form of $\C{K}_{ij}$:
\begin{align*}
  \C{K}_{ij} = 
  \frac{1}{4} \tr 
  \Big\{
  &   \big[ {\U\rho}_i, {\U\Sigma} \big] {\U G}^R {\U\Sigma} {\U G}^R {\U\rho}_j
    + {\U\Sigma} {\U G}^A \big[ {\U\rho}_i, {\U\Sigma} \big] {\U G}^R {\U\rho}_j \\
  & - {\U G}^A \big[ {\U\rho}_i, {\U\Sigma} \big] {\U G}^R {\U\Sigma} {\U \rho}_j
    - {\U G}^A {\U\Sigma} {\U G}^A \big[ {\U\rho}_i, {\U\Sigma} \big] {\U \rho}_j
  \Big\}
\end{align*}
This expression has some symmetries.
Let us use the cyclic trace rule to rewrite it such that the commutator $\big[ {\U\rho}_i, {\U\Sigma} \big]$ comes first in each term:
\begin{align*}
  \C{K}_{ij} = 
  \frac{1}{4} \tr 
  \Big\{
  &   \big[ {\U\rho}_i, {\U\Sigma} \big] {\U G}^R {\U\Sigma} {\U G}^R {\U\rho}_j
    + \big[ {\U\rho}_i, {\U\Sigma} \big] {\U G}^R {\U\rho}_j {\U\Sigma} {\U G}^A \\
  & - \big[ {\U\rho}_i, {\U\Sigma} \big] {\U G}^R {\U\Sigma} {\U \rho}_j {\U G}^A
    - \big[ {\U\rho}_i, {\U\Sigma} \big] {\U \rho}_j {\U G}^A {\U\Sigma} {\U G}^A
  \Big\}
\end{align*}
It then becomes clear that this commutator can be factored out of all terms.
Furthermore, we see that the terms proportional to ${\U G}^R \cdots {\U G}^A$ have a commutator structure.
Thus, the above may be simplified to:
\begin{align*}
  \C{K}_{ij} = 
  \frac{1}{4} \tr 
  \Big\{
      \big[ {\U\rho}_i, {\U\Sigma} \big]
      \left( 
        {\U G}^R {\U\Sigma} {\U G}^R {\U\rho}_j
      - {\U \rho}_j {\U G}^A {\U\Sigma} {\U G}^A
      + {\U G}^R \big[{\U \rho}_j, {\U\Sigma} \big] {\U G}^A
      \right)
  \Big\}
\end{align*}
This solves the problem of second-order terms $\UV{U} \sim \big[\UV{\Sigma}\UV{G}\UV{\Sigma}, \UV{G}\big]$.

\section{Summary}
If we have a very general Usadel equation of the form:
\begin{align}
  iD \partial_z(\UV{G} \partial_z \UV{G}) = \big[ \UV{\Sigma}^{(1)} + \UV{\Sigma}^{(2)}\UV{G}\UV{\Sigma}^{(2)}, \UV{G} \big],
\end{align} 
I have shown that the Pauli-decomposed Usadel equation may be written:
\begin{equation}
  \BC{M} \partial_z^2 \BC{H} = -\big[ (\partial_z\BC{M}) + \BC{Q} \big] \partial_z \BC{H} - \big[ (\partial_z \BC{Q}) + \BC{K} \big] \BC{H}
\end{equation}
Where the contributions to $\BC{K}$ from the $\UV{\Sigma}^{(1)}$ and $\UV{\Sigma}^{(2)}$ terms are given by:
\begin{align*}
  \C{K}_{ij}^{(1)}
  &= 
  \frac{1}{4} \tr\left\{ \big[{\U \rho_i}, {\U\Sigma}^{(1)}\big] \left({\U G}^R {\U \rho}_j - {\U \rho}_j {\U G}^A\right) \right\},
  \\
  \C{K}_{ij}^{(2)}
  &= 
  \frac{1}{4} \tr 
  \Big\{
      \big[ {\U\rho}_i, {\U\Sigma}^{(2)} \big]
      \left( 
        {\U G}^R {\U\Sigma}^{(2)} {\U G}^R {\U\rho}_j
      - {\U \rho}_j {\U G}^A {\U\Sigma}^{(2)} {\U G}^A
      + {\U G}^R \big[{\U \rho}_j, {\U\Sigma}^{(2)} \big] {\U G}^A
      \right)
  \Big\}.
\end{align*}
Note that since these matrices $\BC{Q}$, $\BC{M}$, and $\BC{K}$ are all completely independent of the nonequilibrium distribution function $\BC{H}$ and its derivatives, these can be precomputed from the equilibrium solution.
In other words, the final version of the kinetic equation can be written:
\begin{equation}
  \partial_z^2\BC{H} = \BC{C}_1 \partial_z \BC{H} + \BC{C}_2 \BC{H},
\end{equation}
where $\BC{C}_1$ and $\BC{C}_2$ are straight-forward to compute from the self-energies ${\UV\Sigma}^{(1)}$ and ${\UV\Sigma}^{(2)}$ and equilibrium propagators ${\UV G}^R$ and ${\UV G}^A$, and these coefficients only need to be computed once.
This yields an explicit linear differential equation for $\BC{H}$, which can be solved very efficiently numerically, and which should also be relatively simple to implement.
In its current form, the equation above will likely be even faster to solve than the Riccati-parametrized Usadel equation for the retarded propagator.

\clearpage
\section{Numerics}
We had reformulated the differential equation as:
\begin{equation}
  \partial_z^2\BC{H} = \BC{C}_1 \partial_z \BC{H} + \BC{C}_2 \BC{H}.
\end{equation}
This can be written as a first-order ordinary differential equation:
\begin{equation}
  \frac{d}{dz}
  \begin{pmatrix}
    \!\phantom{'}\BC{H}'\, \\
    \!\BC{H}\,
  \end{pmatrix}
  = 
  \begin{pmatrix}
    \BC{C}_1 & \BC{C}_2 \\
    1        & 0
  \end{pmatrix}
  \begin{pmatrix}
    \!\phantom{'}\BC{H}' \\
    \!\BC{H}
  \end{pmatrix}
\end{equation}
Note that this gives us an explicit form for the Jacobian, which can be provided directly to the boundary value problem solver.




\clearpage
\chapter{Physical observables}
\section{Introduction}
My equilibrium simulation program supports the calculation of the following physical observables:
  selfconsistent superconducting gap;
  charge and spin supercurrents;
  singlet/triplet decomposition of these currents;
  induced magnetization;
  and density of states.
Now that we are moving to nonequilibrium simulations, these equations need to be generalized.

First of all, the selfconsistency equation for the superconducting gap needs to be replaced with a version that depends on the nonequilibrium distribution.
The supercurrent equations need to be replaced with nonequilbrium versions, and in addition, we wish to calculate resistive currents now.
The induced magnetization needs to be supplemented with nonequilibrium charge and spin accumulation.
Furthermore, in nonequilibrium systems we might want to calculate heat currents and heat accumulation too.
Finally, since we're already rewriting a lot of the code for physical observables anyway, we might as well implement support for the spin-polarization of the density of states as well, which could be useful in the theoretical analysis.

This leaves one unaddressed point in the list above: the singlet/triplet decomposition of the charge current.
I believe that such a decomposition should still be possible in a general nonequilibrium setting, however Morten's current derivation assumes an equilibrium distribution function, and a nonequilibrium generalization would be more complex.
I therefore won't generalize this equation to nonequilibrium for now, but we can get back to this in the future if it turns out that we'll need it.

On the next pages, I'll write down the equations needed to consider all the points above theoretically, which I intend to implement numerically.
For now, I ignore the presence of spin-orbit coupling, which means that the equations for the currents will not be completely general, but they should be general enough to describe the spin-current project that we will be working on.
In the future, we can generalize these results if we need it for a spin-orbit coupled project, which should in practice only mean that we need to add a couple of new terms to the definition of the $\BC{M}$ and $\BC{Q}$ matrices in the code.



\clearpage
\section{Matrix current}
The full $8\times8$ matrix current is given by the expression:
\begin{align}
  \UV{I} 
  &= 
  \UV{G} \nabla \UV{G}
  \\ &= 
  \begin{pmatrix} 
    \U{G}^R  & \U{G}^K \\[1ex] 0 & \U{G}^A
  \end{pmatrix}
  \begin{pmatrix} 
    \nabla\U{G}^R  & \nabla\U{G}^K \\[1ex] 0 & \nabla\U{G}^A
  \end{pmatrix}
  \\ &= 
  \begin{pmatrix} 
    \U{G}^R\nabla\U{G}^R  & \U{G}^R\nabla\U{G}^K + \U{G}^K\nabla\U{G}^A \\[1ex] 0 & \U{G}^A\nabla\U{G}^A
  \end{pmatrix}
\end{align}
So the Keldysh component of the matrix current is:
\begin{align}
  \U{I}^K = \U{G}^R\nabla\U{G}^K + \U{G}^K\nabla\U{G}^A
\end{align}
Let us now substitute in $\U{G}^K = \U{G}^R \U{H} - \U{H} \U{G}^A$:
\begin{align*}
  \U{I}^K 
  &= 
  \U{G}^R\nabla(\U{G}^R \U{H} - \U{H} \U{G}^A)+ (\U{G}^R \U{H} - \U{H} \U{G}^A) \nabla\U{G}^A 
  \\ &=
  \U{G}^R(\nabla\U{G}^R) \U{H} + \U{G}^R\U{G}^R (\nabla\U{H}) - \U{G}^R (\nabla\U{H}) \U{G}^A 
  \\ &
  - \U{G}^R \U{H} (\nabla\U{G}^A) + \U{G}^R \U{H}(\nabla\U{G}^A) - \U{H} \U{G}^A (\nabla\U{G}^A)
  \\ &=
  \big[ (\U{G}^R \nabla \U{G}^R) \U{H} - \U{H} (\U{G}^A \nabla \U{G}^A) \big]
  \\ &\,+
  \big[ (\nabla\U{H}) - \U{G}^R (\nabla\U{H}) \U{G}^A \big]
\end{align*}
Let us give these two contributions to $\U{I}^K$ separate names:
\begin{align}
  \U{S}\, &\equiv (\U{G}^R \nabla \U{G}^R) \U{H} - \U{H} (\U{G}^A \nabla \U{G}^A),  \\
  \U{R}\, &\equiv (\nabla\U{H}) - \U{G}^R (\nabla\U{H}) \U{G}^A.
\end{align}
The first contribution $\U{S}$ is the \emph{supercurrent contribution} to the matrix current, which is independent of any potential gradients $\nabla\U{H}$, and can be nonzero even in equilibrium.
This is the matrix current equivalent to what Chandrasekhar and Tom called $\BC{Q}\BC{H}$.
As for the second contribution $\U{R}$, this is the \emph{resistive contribution} to the matrix current, which is only present when we have a potential gradient $\nabla\U{H}$.
This is what Chandrasekhar and Tom called $\BC{M}\nabla\BC{H}$.

\clearpage
\section{Energy symmetries}
In this section, I point out some new symmetries I noticed in the propagators, which will be useful to simplify the results derived in the following sections.
First, let us write out the structure of the propagators and distribution:
\begin{align}
  \U{G}^R &= 
  \begin{pmatrix}
    +\U{g}^R  & +\U{f}^R  \\[1ex]
   -\TU{f}^R & -\TU{g}^R
  \end{pmatrix} \\
  \U{G}^A &= 
  \begin{pmatrix}
    +\U{g}^A  & +\U{f}^A  \\[1ex]
   -\TU{f}^A & -\TU{g}^A
  \end{pmatrix} \\
  \U{G}^K &= 
  \begin{pmatrix}
    +\U{g}^K  & +\U{f}^K  \\[1ex]
   +\TU{f}^K & +\TU{g}^K
  \end{pmatrix} \\
  \U{H} \;&= \;
  \begin{pmatrix}
    \PM\U{h}  & \PM0\PM  \\[1ex]
    \PM0      & -\TU{h}\PM
  \end{pmatrix}
\end{align}
By explicit calculations, one can show that multiplying by $\N{1}$ from the left is equivalent to permuting rows, while multiplying by $\N{1}$ from the right permutes columns.
If we do both, we see from the structures above that:
\begin{align}
  \N{1} \U{G}^R \N{1}   &= -\TU{G}^R \\
  \N{1} \U{G}^A \N{1}   &= -\TU{G}^A \\
  \N{1} \U{G}^K \N{1}   &= +\TU{G}^K \\
  \N{1} \,\U{H}\, \N{1} &= -\TU{H}
\end{align}
Since tilde-conjugating is per definition a combination of complex conjugation $i \rightarrow -i$ and energy reversal $\epsilon \rightarrow -\epsilon$, this means that we get some simple identities relating the positive- and negative-energy propagators:
\begin{align}
  \U{G}^R(-\epsilon) &= -\N{1}\U{G}^{R*}(+\epsilon)\,\N{1} \\
  \U{G}^A(-\epsilon) &= -\N{1}\U{G}^{A*}(+\epsilon)\,\N{1} \\
  \U{G}^K(-\epsilon) &= +\N{1}\U{G}^{K*}(+\epsilon)\,\N{1} \\
  \U{H}(-\epsilon)   &= -\N{1}\U{H}^{*}(+\epsilon) \,\N{1}
\end{align}
If we substitute this into the matrix currents from the previous section:
\begin{align}
  \U{I}^K(-\epsilon) &= -\N{1} \U{I}^{K*}(+\epsilon)\N{1}, \\
  \U{S}(-\epsilon)\, &= -\N{1} \U{S}^*(+\epsilon)\, \N{1}, \\
  \U{R}(-\epsilon)\, &= -\N{1} \U{R}^*(+\epsilon)\, \N{1}.
\end{align}


\clearpage
\section{Charge and spin accumulation}
The charge density $\rho_e = e\rho_0$ and spin density $\B{\rho}_s = (\hbar/2)(\rho_1, \rho_2, \rho_3)$ can be found by performing the four integrals ($n=0,\ldots,3$):
\begin{equation}
  \rho_n = -\frac{1}{8}N_0 \int_{-\infty}^{+\infty} \d\epsilon \tr\big[ \S{n} \U{G}^K \big].
\end{equation}
We can then use the previously derived identity $\U{G}^K(-\epsilon) = \N{1} \U{G}^{K*}(+\epsilon) \,\N{1}$ to rewrite this as an integral over only positive energies:
\begin{equation}
  \rho_n = -\frac{1}{8}N_0 \int_{0}^{\infty} \d\epsilon \tr\big[ \S{n} (\U{G}^K + \N{1} \U{G}^{K*} \N{1})\big].
\end{equation}
We then use the cyclic trace rule to get rid of the superfluous Pauli matrices:
\begin{equation}
  \rho_n = -\frac{1}{8}N_0 \int_{0}^{\infty} \d\epsilon \tr\big[ \S{n} (\U{G}^K + \U{G}^{K*})\big].
\end{equation}
Recognizing this as simply the real part of the propagator, we get:
\begin{equation}
  \rho_n = -\frac{1}{4}N_0 \int_{0}^{\infty} \d\epsilon \re\tr\big[ \S{n} \U{G}^K \big].
\end{equation}
In order to separate the induced magnetization from the nonequilibrium spin accumulation, the propagator $\U{G}^K$ in the equations above may be replaced with difference from equilibrium $\U{G}^K-\U{G}^K_\text{\,eq}$ as in e.g. the Silaev paper.

\clearpage
\section{Heat and spin-heat accumulation}
The heat density $\kappa_{e} = e\kappa_0$ and spin-heat density $\B{\kappa}_{s} = (\hbar/2)(\kappa_1, \kappa_2, \kappa_3)$ may be calculated from the four integrals ($n=0,\ldots,3$):
\begin{equation}
  \kappa_n = -\frac{1}{8}N_0 \int_{-\infty}^{+\infty} \d\epsilon \tr\big[ \epsilon\N{3}\S{n} \U{G}^K \big].
\end{equation}
This may again be rewritten as an integral over positive energies using $\U{G}^K(-\epsilon) = \N{1} \U{G}^{K*}(+\epsilon) \N{1}$, but get a sign flip because the prefactor $\epsilon \rightarrow -\epsilon$:
\begin{equation}
  \kappa_n = -\frac{1}{8}N_0 \int_{0}^{\infty} \d\epsilon \tr\big[ \epsilon\N{3}\S{n} (\U{G}^K - \N{1} \U{G}^{K*} \N{1}) \big].
\end{equation}
We then use the cyclic rule and the fact that $\N{1}\N{3}\N{1} = -\N{3}$:
\begin{equation}
  \kappa_n = -\frac{1}{8}N_0 \int_{0}^{\infty} \d\epsilon \tr\big[ \epsilon\N{3}\S{n} (\U{G}^K + \U{G}^{K*}) \big].
\end{equation}
We again recognize the integrand as the real part of the propagator:
\begin{equation}
  \kappa_n = -\frac{1}{4}N_0 \int_{0}^{\infty} \d\epsilon \re\tr\big[ \epsilon\N{3}\S{n} \U{G}^K \big].
\end{equation}
As before, the equilibrium and nonequilibrium contributions may be separated by replacing $\U{G}^K \rightarrow \U{G}^K - \U{G}^K_\text{eq}$ in the equation above.



\clearpage
\section{Charge and spin currents}
The total charge current $I_e = eI_0$ and spin current $\B{I}_s = (\hbar/2)(I_1,I_2,I_3)$ can be calculated from the four integrals ($n=0,\ldots,3$):
\begin{equation}
  I_n &= \frac{1}{8}N_0D \int_{-\infty}^{+\infty} \d\epsilon \tr\big[ \N{3} \S{n} \U{I}^K \big]
\end{equation}
Using $\U{I}^K(-\epsilon) = -\N{1} \U{I}^{K*}(+\epsilon) \N{1}$, the cyclic rule, and $\N{1}\N{3}\N{1} = -\N{3}$ like before:
\begin{equation} 
  I_n &= \frac{1}{8}N_0D \int_{0}^{\infty} \d\epsilon \tr\big[ \N{3} \S{n} (\U{I}^K + \U{I}^{K*}) \big]
\end{equation}
Recognizing this as the real part of the matrix current, we get:
\begin{equation} 
  I_n &= \frac{1}{4}N_0D \int_{0}^{\infty} \d\epsilon \re\tr\big[ \N{3} \S{n} \U{I}^K \big]
\end{equation}
By replacing the total matrix current $\U{I}^K$ by the supercurrent $\U{S}$ and resistive current $\U{R}$, respectively, we then obtain the corresponding contributions to the charge and spin currents:
\begin{align} 
  I_{n,s} &= \frac{1}{4}N_0D \int_{0}^{\infty} \d\epsilon \re\tr\big[ \N{3} \S{n} \U{S} \big]\\
  I_{n,r} &= \frac{1}{4}N_0D \int_{0}^{\infty} \d\epsilon \re\tr\big[ \N{3} \S{n} \U{R} \big]
\end{align}

\textcolor{red}{Alternatives: use $I$ for resistive currents and $J$ for supercurrents, or use $I$ for electric/spin currents and $J$ for thermal electric/spin currents.}


\clearpage
\section{Heat and spin-heat currents}
The total heat current $J_e = eJ_0$ and spin-heat current $\B{J}_s = (\hbar/2)(J_1, J_2, J_3)$ can be calculated from the four integrals ($n=0,\ldots,3$):
\begin{equation}
  J_n &= \frac{1}{8}N_0D \int_{-\infty}^{+\infty} \d\epsilon \tr\big[ \epsilon \S{n} \U{I}^K \big]
\end{equation}
Using $\U{I}^K(-\epsilon) = -\N{1} \U{I}^{K*}(+\epsilon) \N{1}$, the cyclic rule, and $\epsilon \rightarrow -\epsilon$ like before:
\begin{equation}
  J_n &= \frac{1}{8}N_0D \int_{0}^{\infty} \d\epsilon \tr\big[ \epsilon \S{n} (\U{I}^K + \U{I}^{K*}) \big]
\end{equation}
We again recognize this as the real part of the current:
\begin{equation}
  J_n &= \frac{1}{4}N_0D \int_{0}^{\infty} \d\epsilon \re\tr\big[ \epsilon \S{n} \U{I}^K \big]
\end{equation}
To split the result into contributions due to supercurrents and resistive currents, we replace $\U{I}^K$ by either $\U{S}$ or $\U{R}$ in the equation above:
\begin{align}
  J_{n,r} &= \frac{1}{4}N_0D \int_{0}^{\infty} \d\epsilon \re\tr\big[ \epsilon \S{n} \U{R} \big] \\
  J_{n,s} &= \frac{1}{4}N_0D \int_{0}^{\infty} \d\epsilon \re\tr\big[ \epsilon \S{n} \U{S} \big]
\end{align}



\clearpage
\section{Superconducting gap}
During my Master thesis, we rederived the selfconsistency equation for the superconducting gap from the definition of the Keldysh propagator.
One of the intermediate results we obtained was the following [Eq.~(3.16)]:
\begin{equation}
  \Delta = \frac{1}{8} N_0\lambda \!\!\int_{\;-\omega_c}^{\;+\omega_c} \!\!\d\epsilon\, \big[ f^K_{\up\dn}(\epsilon) - f^K_{\dn\up}(\epsilon) \big]
\end{equation}
This was the last equation we obtained before assuming an equilibrium distribution function, and therefore a natural startpoint for finding an appropriate nonequilibrium selfconsistency equation.
This equation may be rewritten in terms of the $2\times2$ propagator $\U{f}^K$:
\begin{equation}
  \Delta = \frac{1}{8} N_0\lambda \!\!\int_{\;-\omega_c}^{\;+\omega_c} \!\!\d\epsilon\, \tr\left[ (-i\S{2})\U{f}^K \right]
\end{equation}
This seems like a reasonable result, as we know from before that the parts of the anomalous propagator proportional to $i\S{2}$ is the singlet component.
Furthermore, we by definition have the identity $\U{f}^K(-\epsilon) = \TU{f}^{K*}(+\epsilon)$, which we can use to rewrite this as an integral over only positive energies:
\begin{equation}
  \Delta = \frac{1}{8} N_0\lambda \!\!\int_{0}^{\;\;\omega_c} \!\!\d\epsilon\, \tr\left[ (-i\S{2})\big(\U{f}{}^K + \TU{f}{}^{K*}\big)\right]
\end{equation}
In other words, if we know the $4\times4$ Keldysh propagator~$\U{G}^K$, then the selfconsistent gap can be calculated directly from its off-diagonal blocks:
\begin{equation}
  \Delta = \frac{1}{8} N_0\lambda \!\!\int_{0}^{\;\;\omega_c} \!\!\d\epsilon\, \tr\left[ (-i\S{2})\big(\U{G}{}^K_{12} + \U{G}{}^{K*}_{21}\big)\right]
\end{equation}
We could rewrite this using explicit Nambu-space traces, where $(\N{1} \pm i\N{2})/2$ can be used to extract the off-diagonal blocks of $\U{G}{}^K$.
However, in contrast to the other observables we looked at, the equation above only becomes more complicated if we try rewriting it in this way, since we then end up with separate equations for $\re(\Delta)$ and $\im(\Delta)$.
I therefore intend to use this form.



\clearpage
\section{Density of states}
Might be interesting to expand to spin-dependent DOS as well.

\clearpage
\section{Summary}
On the previous pages, I have rewritten all the nonequilibrium observables in terms of only the positive-energy propagators.
This has several benefits.
First of all, every equation except the superconducting gap ended up with being explicitly real quantities, which is a nice quality for an equation that is supposed to represent real physical observables.
Secondly, this means that we only need to solve the Usadel equation for positive energies as before, which saves computation time.
Finally, while the trace-tricks we derived during the project with Tom are nice for recasting the Usadel equation in a more suitable form, evaluating e.g. charge and spin currents is actually a bit easier to implement the ``old-fashioned way''.

Interestingly, all the cancellations lead to the ``naive'' results: if we integrate over positive energies and look at the real part, that's a good description.
