\chapter{Physical observables}
\section{Introduction}
My equilibrium simulation program currently supports the calculation of the following physical observables:
  selfconsistent superconducting gap;
  charge and spin supercurrents;
  singlet/triplet decomposition of these currents;
  induced magnetization;
  and density of states.
Now that we are moving to nonequilibrium simulations, these equations need to be generalized.

First of all, the selfconsistency equation for the superconducting gap needs to be replaced with a version that depends on the nonequilibrium distribution.
The supercurrent equations need to be replaced with nonequilbrium versions, and in addition, we wish to calculate resistive currents now.
The induced magnetization needs to be supplemented with nonequilibrium charge and spin accumulation.
Furthermore, in nonequilibrium systems we might want to calculate heat currents and heat accumulation too.
Finally, since we're already rewriting a lot of the code for physical observables anyway, we might as well implement support for the spin-polarization of the density of states as well, which could be useful in the theoretical analysis.

This leaves one unaddressed point in the list above: the singlet/triplet decomposition of the charge current.
I believe that such a decomposition should still be possible in a general nonequilibrium setting, however Morten's current derivation assumes an equilibrium distribution function, and a nonequilibrium generalization would probably be more complex.
I therefore won't generalize this equation to nonequilibrium for now, but we can get back to this in the future if it turns out that we'll need it at some point.

Using a Pauli-decomposition of the distribution function -- as in the paper with Tom -- is very efficient for parametrizing the nonequilibrium Usadel equation itself, since it permits a straight-forward way to separate the equilibrium and nonequilibrium quantities in the equation.
However, when it comes to calculating physical observables, most quantities turn out to be easier to express directly in terms of either the propagator~$\U{G}^K$ or matrix current~$\U{I}^K$, instead of performing an explicit Pauli-decomposition of the equations.
I therefore focused on this strategy in the derivations that follow.

TODO: Divide all currents and accumulations by 2.


\clearpage
\section{Matrix current}
The full $8\times8$ matrix current is given by the expression:
\begin{align}
  \UV{I} 
  &= 
  \UV{G} \nabla \UV{G}
  \\ &= 
  \begin{pmatrix} 
    \U{G}^R  & \U{G}^K \\[1ex] 0 & \U{G}^A
  \end{pmatrix}
  \begin{pmatrix} 
    \nabla\U{G}^R  & \nabla\U{G}^K \\[1ex] 0 & \nabla\U{G}^A
  \end{pmatrix}
  \\ &= 
  \begin{pmatrix} 
    \U{G}^R\nabla\U{G}^R  & \U{G}^R\nabla\U{G}^K + \U{G}^K\nabla\U{G}^A \\[1ex] 0 & \U{G}^A\nabla\U{G}^A
  \end{pmatrix}
\end{align}
So the Keldysh component of the matrix current is:
\begin{align}
  \U{I}^K = \U{G}^R\nabla\U{G}^K + \U{G}^K\nabla\U{G}^A
\end{align}
Let us now substitute in $\U{G}^K = \U{G}^R \U{H} - \U{H} \U{G}^A$:
\begin{align*}
  \U{I}^K 
  &= 
  \U{G}^R\nabla(\U{G}^R \U{H} - \U{H} \U{G}^A)+ (\U{G}^R \U{H} - \U{H} \U{G}^A) \nabla\U{G}^A 
  \\ &=
  \U{G}^R(\nabla\U{G}^R) \U{H} + \U{G}^R\U{G}^R (\nabla\U{H}) - \U{G}^R (\nabla\U{H}) \U{G}^A 
  \\ &
  - \U{G}^R \U{H} (\nabla\U{G}^A) + \U{G}^R \U{H}(\nabla\U{G}^A) - \U{H} \U{G}^A (\nabla\U{G}^A)
  \\ &=
  \big[ (\U{G}^R \nabla \U{G}^R) \U{H} - \U{H} (\U{G}^A \nabla \U{G}^A) \big]
  \\ &\,+
  \big[ (\nabla\U{H}) - \U{G}^R (\nabla\U{H}) \U{G}^A \big]
\end{align*}
Let us give these two bracketed contributions to $\U{I}^K$ separate names:
\begin{align}
  \U{S}\, &\equiv (\U{G}^R \nabla \U{G}^R) \U{H} - \U{H} (\U{G}^A \nabla \U{G}^A),  \\
  \U{R}\, &\equiv (\nabla\U{H}) - \U{G}^R (\nabla\U{H}) \U{G}^A.
\end{align}
The first contribution $\U{S}$ is the \emph{supercurrent contribution} to the matrix current, which is independent of any potential gradients $\nabla\U{H}$, and can be nonzero even in equilibrium.
This is the matrix current equivalent to what Chandrasekhar and Tom called $\BC{Q}\BC{H}$.
As for the second contribution $\U{R}$, this is the \emph{resistive contribution} to the matrix current, which is only present when we have a potential gradient $\nabla\U{H}$.
This is what Chandrasekhar and Tom called $\BC{M}\nabla\BC{H}$.

\clearpage
\section{Energy symmetries}
In this section, I point out some new symmetries I noticed in the propagators, which will be useful to simplify the results derived in the following sections.
First, let us write out the structure of the propagators and distribution:
\begin{align}
  \U{G}^R &= 
  \begin{pmatrix}
    +\U{g}^R  & +\U{f}^R  \\[1ex]
   -\TU{f}^R & -\TU{g}^R
  \end{pmatrix} \\
  \U{G}^A &= 
  \begin{pmatrix}
    +\U{g}^A  & +\U{f}^A  \\[1ex]
   -\TU{f}^A & -\TU{g}^A
  \end{pmatrix} \\
  \U{G}^K &= 
  \begin{pmatrix}
    +\U{g}^K  & +\U{f}^K  \\[1ex]
   +\TU{f}^K & +\TU{g}^K
  \end{pmatrix} \\
  \U{H} \;&= \;
  \begin{pmatrix}
    \PM\U{h}  & \PM0\PM  \\[1ex]
    \PM0      & -\TU{h}\PM
  \end{pmatrix}
\end{align}
By explicit calculations, one can show that multiplying by $\N{1}$ from the left is equivalent to permuting rows, while multiplying by $\N{1}$ from the right permutes columns.
If we do both, we see from the structures above that:
\begin{align}
  \N{1} \U{G}^R \N{1}   &= -\TU{G}^R \\
  \N{1} \U{G}^A \N{1}   &= -\TU{G}^A \\
  \N{1} \U{G}^K \N{1}   &= +\TU{G}^K \\
  \N{1} \,\U{H}\, \N{1} &= -\TU{H}
\end{align}
Since tilde-conjugating is per definition a combination of complex conjugation $i \rightarrow -i$ and energy reversal $\epsilon \rightarrow -\epsilon$, this means that we get some simple identities relating the positive- and negative-energy propagators:
\begin{align}
  \U{G}^R(-\epsilon) &= -\N{1}\U{G}^{R*}(+\epsilon)\,\N{1} \\
  \U{G}^A(-\epsilon) &= -\N{1}\U{G}^{A*}(+\epsilon)\,\N{1} \\
  \U{G}^K(-\epsilon) &= +\N{1}\U{G}^{K*}(+\epsilon)\,\N{1} \\
  \U{H}(-\epsilon)   &= -\N{1}\U{H}^{*}(+\epsilon) \,\N{1}
\end{align}
If we substitute this into the matrix currents from the previous section:
\begin{align}
  \U{I}^K(-\epsilon) &= -\N{1} \U{I}^{K*}(+\epsilon)\N{1}, \\
  \U{S}(-\epsilon)\, &= -\N{1} \U{S}^*(+\epsilon)\, \N{1}, \\
  \U{R}(-\epsilon)\, &= -\N{1} \U{R}^*(+\epsilon)\, \N{1}.
\end{align}


\clearpage
\section{Charge and spin accumulation}
The charge density $\mu_e = e\mu_0$ and spin density $\B{\mu}_s = (\hbar/2)(\mu_1, \mu_2, \mu_3)$ can be found by performing the four integrals ($n=0,\ldots,3$):
\begin{equation}
  \mu_n = -\frac{1}{8}N_F  \int_{-\infty}^{+\infty} \d\epsilon \tr\big[ \S{n} \U{G}^K \big].
\end{equation}
We can then use the previously derived identity $\U{G}^K(-\epsilon) = \N{1} \U{G}^{K*}(+\epsilon) \,\N{1}$ to rewrite this as an integral over only positive energies:
\begin{equation}
  \mu_n = -\frac{1}{8}N_F  \int_{0}^{\infty} \d\epsilon \tr\big[ \S{n} (\U{G}^K + \N{1} \U{G}^{K*} \N{1})\big].
\end{equation}
We then use the cyclic trace rule to get rid of the superfluous Pauli matrices:
\begin{equation}
  \mu_n = -\frac{1}{8}N_F  \int_{0}^{\infty} \d\epsilon \tr\big[ \S{n} (\U{G}^K + \U{G}^{K*})\big].
\end{equation}
Recognizing this as simply the real part of the propagator, we get:
\begin{equation}
  \mu_n = -\frac{1}{4}N_F  \int_{0}^{\infty} \d\epsilon \re\tr\big[ \S{n} \U{G}^K \big].
\end{equation}
In order to separate the induced magnetization from the nonequilibrium spin accumulation, the propagator $\U{G}^K$ in the equations above may be replaced with difference from equilibrium $\U{G}^K-\U{G}^K_\text{\,eq}$ as in e.g. the Silaev paper.

Note: one detail I glossed over in the derivation above, is that $\S{n}$ should really be a $4\times4$ matrix $\text{diag}(\S{n},\S{n}^*)$.
In this case, $\text{diag}(\S{2}, \S{2}^*) = \N{3}\S{2}$ is different from the other spin components, as it gets one sign flip under complex conjugation, and another sign flip when sandwiched by $\N{1}$ matrices because $\N{1}\N{3}\N{1}=-\N{3}$.
The final result above should however be the same.

\clearpage
\section{Heat and spin-heat accumulation}
The heat density $\kappa_{e} = \kappa_0$ and spin-heat density $\B{\kappa}_{s} = (\kappa_1, \kappa_2, \kappa_3)$ may be calculated from the four integrals ($n=0,\ldots,3$):
\begin{equation}
  \kappa_n = -\frac{1}{8}N_F  \int_{-\infty}^{+\infty} \d\epsilon \tr\big[ \epsilon\N{3}\S{n} \U{G}^K \big].
\end{equation}
This may again be rewritten as an integral over positive energies using $\U{G}^K(-\epsilon) = \N{1} \U{G}^{K*}(+\epsilon) \N{1}$, but we get a sign flip because the prefactor $\epsilon \rightarrow -\epsilon$:
\begin{equation}
  \kappa_n = -\frac{1}{8}N_F  \int_{0}^{\infty} \d\epsilon \tr\big[ \epsilon\N{3}\S{n} (\U{G}^K - \N{1} \U{G}^{K*} \N{1}) \big].
\end{equation}
We then use the cyclic rule and the fact that $\N{1}\N{3}\N{1} = -\N{3}$:
\begin{equation}
  \kappa_n = -\frac{1}{8}N_F  \int_{0}^{\infty} \d\epsilon \tr\big[ \epsilon\N{3}\S{n} (\U{G}^K + \U{G}^{K*}) \big].
\end{equation}
We again recognize the integrand as the real part of the propagator:
\begin{equation}
  \kappa_n = -\frac{1}{4}N_F  \int_{0}^{\infty} \d\epsilon \re\tr\big[ \epsilon\N{3}\S{n} \U{G}^K \big].
\end{equation}
As before, the equilibrium and nonequilibrium contributions may be separated by replacing $\U{G}^K \rightarrow \U{G}^K - \U{G}^K_\text{eq}$ in the equation above.



\clearpage
\section{Charge and spin currents}
The charge current $I_e = eI_0$ and spin current $\B{I}_s = (\hbar/2)(I_1,I_2,I_3)$ can be calculated from the four integrals ($n=0,\ldots,3$):
\begin{equation}
  I_n &= \frac{1}{8}N_F D \int_{-\infty}^{+\infty} \d\epsilon \tr\big[ \N{3} \S{n} \U{I}^K \big]
\end{equation}
Using $\U{I}^K(-\epsilon) = -\N{1} \U{I}^{K*}(+\epsilon) \N{1}$, the cyclic rule, and $\N{1}\N{3}\N{1} = -\N{3}$ like before:
\begin{equation} 
  I_n &= \frac{1}{8}N_F D \int_{0}^{\infty} \d\epsilon \tr\big[ \N{3} \S{n} (\U{I}^K + \U{I}^{K*}) \big]
\end{equation}
Recognizing this as the real part of the matrix current, we get:
\begin{equation} 
  I_n &= \frac{1}{4}N_F D \int_{0}^{\infty} \d\epsilon \re\tr\big[ \N{3} \S{n} \U{I}^K \big]
\end{equation}
By replacing the total matrix current $\U{I}^K$ by the supercurrent $\U{S}$ and resistive current $\U{R}$, respectively, we then obtain the corresponding contributions to the charge and spin currents:
\begin{align} 
  I_{n,s} &= \frac{1}{4}N_F D \int_{0}^{\infty} \d\epsilon \re\tr\big[ \N{3} \S{n} \U{S} \big]\\
  I_{n,r} &= \frac{1}{4}N_F D \int_{0}^{\infty} \d\epsilon \re\tr\big[ \N{3} \S{n} \U{R} \big]
\end{align}


\clearpage
\section{Heat and spin-heat currents}
The heat current $J_e = J_0$ and spin-heat current $\B{J}_s = (J_1, J_2, J_3)$ can be calculated from the four integrals ($n=0,\ldots,3$):
\begin{equation}
  J_n &= \frac{1}{8}N_F D \int_{-\infty}^{+\infty} \d\epsilon \tr\big[ \epsilon \S{n} \U{I}^K \big]
\end{equation}
Using $\U{I}^K(-\epsilon) = -\N{1} \U{I}^{K*}(+\epsilon) \N{1}$, the cyclic rule, and $\epsilon \rightarrow -\epsilon$ like before:
\begin{equation}
  J_n &= \frac{1}{8}N_F D \int_{0}^{\infty} \d\epsilon \tr\big[ \epsilon \S{n} (\U{I}^K + \U{I}^{K*}) \big]
\end{equation}
We again recognize this as the real part of the current:
\begin{equation}
  J_n &= \frac{1}{4}N_F D \int_{0}^{\infty} \d\epsilon \re\tr\big[ \epsilon \S{n} \U{I}^K \big]
\end{equation}
To split the result into contributions due to supercurrents and resistive currents, we replace $\U{I}^K$ by either $\U{S}$ or $\U{R}$ in the equation above:
\begin{align}
  J_{n,r} &= \frac{1}{4}N_F D \int_{0}^{\infty} \d\epsilon \re\tr\big[ \epsilon \S{n} \U{R} \big] \\
  J_{n,s} &= \frac{1}{4}N_F D \int_{0}^{\infty} \d\epsilon \re\tr\big[ \epsilon \S{n} \U{S} \big]
\end{align}



\clearpage
\section{Superconducting gap}
During my Master thesis, we rederived the selfconsistency equation for the superconducting gap from the definition of the Keldysh propagator.
One of the intermediate results we obtained was the following [Eq.~(3.16)]:
\begin{equation}
  \Delta = \frac{1}{8} N_F \lambda \!\!\int_{\;-\omega_c}^{\;+\omega_c} \!\!\d\epsilon\, \big[ f^K_{\up\dn}(\epsilon) - f^K_{\dn\up}(\epsilon) \big]
\end{equation}
This was the last equation we obtained before assuming an equilibrium distribution function, and therefore a natural startpoint for finding an appropriate nonequilibrium selfconsistency equation.
This equation may be rewritten in terms of the $2\times2$ propagator $\U{f}^K$:
\begin{equation}
  \Delta = \frac{1}{8} N_F \lambda \!\!\int_{\;-\omega_c}^{\;+\omega_c} \!\!\d\epsilon\, \tr\left[ (-i\S{2})\U{f}^K \right]
\end{equation}
This seems like a reasonable result, as we know from before that the parts of the anomalous propagator proportional to $i\S{2}$ is the singlet component.
Furthermore, we by definition have the identity $\U{f}^K(-\epsilon) = \TU{f}^{K*}(+\epsilon)$, which we can use to rewrite this as an integral over only positive energies:
\begin{equation}
  \Delta = \frac{1}{8} N_F \lambda \!\!\int_{0}^{\;\;\omega_c} \!\!\d\epsilon\, \tr\left[ (-i\S{2})\big(\U{f}{}^K + \TU{f}{}^{K*}\big)\right]
\end{equation}
In other words, if we know the $4\times4$ Keldysh propagator~$\U{G}^K$, then the selfconsistent gap can be calculated directly from its off-diagonal blocks:
\begin{equation}
  \Delta = \frac{1}{8} N_F \lambda \!\!\int_{0}^{\;\;\omega_c} \!\!\d\epsilon\, \tr\left[ (-i\S{2})\big(\U{G}{}^K_{12} + \U{G}{}^{K*}_{21}\big)\right]
\end{equation}
We could rewrite this using explicit Nambu-space traces, where $(\N{1} \pm i\N{2})/2$ can be used to extract the off-diagonal blocks of $\U{G}{}^K$.
However, in contrast to the other observables we looked at, the equation above only becomes more complicated if we try rewriting it in this way, since we then end up with separate equations for $\re(\Delta)$ and $\im(\Delta)$.
I therefore intend to use this form.


\clearpage
\section{Spin-orbit coupling}
To generalize to nanowires with spin-orbit coupling, we need to replace the derivatives $\nabla \rightarrow \nabla - i[\U{A}, \,\cdot\,]$ in the matrix current.
This results in some additional terms in both the supercurrent and resistive current:
\begin{align}
  \U{S} &\rightarrow \U{S} - i\U{S}' \\
  \U{R} &\rightarrow \U{R} - i\U{R}'
\end{align}
When the factor $-i$ is explicitly written in front of the gauge contributions $\U{S}'$ and $\U{R}'$, their definitions become just like $\U{S}$ and $\U{R}$, except that $\nabla \rightarrow [\U{A}, \,\cdot\,]$:
\begin{align}
  \U{S}' &= \U{G}^R [\U{A}, \U{G}^R] \U{H} - \U{H} \U{G}^A [\U{A}, \U{G}^A],  \\
  \U{R}' &= [\U{A}, \U{H}] - \U{G}^R [\U{A}, \U{H}] \U{G}^A.
\end{align}
The explicit structure of the spin-orbit field $\U{A}$ in Nambu-space is:
\begin{equation}
  \U{A} = 
  \begin{pmatrix}
    \U{a} & 0 \\
    0 & -\U{a}^*
  \end{pmatrix}
\end{equation}
From this, we see that we may write the identity:
\begin{equation}
  \U{A} = -\N{1}\U{A}^*\N{1}
\end{equation}
Combined with the previously derived identities for the transformations of $\U{G}^R$, $\U{G}^A$, $\U{H}$ when complex-conjugated and sandwiched between $\N{1}$-matrices:
\begin{align}
  \U{S}'(-\epsilon) &= +\N{1}\U{S}'{}^*(+\epsilon)\N{1} \\
  \U{R}'(-\epsilon) &= +\N{1}\U{S}'{}^*(+\epsilon)\N{1}
\end{align}
In other words, these have a sign change compared to the transformations of $\U{S}$ and $\U{R}$.
Denoting either gauge contribution $\U{S}'$ and $\U{R}'$ with the generic $\U{I}'$, the changes to the charge, spin, heat, and spin-heat currents become:
\begin{align}
  I_n' &= -\frac{i}{8}N_F D \int_{0}^{\infty} \d\epsilon \tr\big[ \N{3} \S{n} (\U{I}' + \N{1}\U{I}'{}^*\N{1}) \big]\\
  J_n' &= -\frac{i}{8}N_F D \int_{0}^{\infty} \d\epsilon \tr\big[ \epsilon \S{n} (\U{I}' - \N{1}\U{I}'{}^*\N{1}) \big]
\end{align}
Using the cyclic rule and that $\N{1}\N{3}\N{1} = -\N{3}$:
\begin{align}
  I_n' &= -\frac{i}{8}N_F D \int_{0}^{\infty} \d\epsilon \tr\big[ \N{3} \S{n} (\U{I}' - \U{I}'{}^*) \big]\\
  J_n' &= -\frac{i}{8}N_F D \int_{0}^{\infty} \d\epsilon \tr\big[ \epsilon \S{n} (\U{I}' - \U{I}'{}^*) \big]
\end{align}
Recognizing the parentheses as $2i\im(\U{I}')$:
\begin{align}
  I_n' &= +\frac{1}{4}N_F D \int_{0}^{\infty} \d\epsilon \im\tr\big[ \N{3} \S{n} \U{I}' \big]\\
  J_n' &= +\frac{1}{4}N_F D \int_{0}^{\infty} \d\epsilon \im\tr\big[ \epsilon \S{n} \U{I}' \big]
\end{align}
Now, in general $\im(u) = \re(-iu)$, so the above can be rewritten as:
\begin{align}
  I_n' &= \frac{1}{4}N_F D \int_{0}^{\infty} \d\epsilon \re\tr\big[ \N{3} \S{n} (-i\U{I}') \big]\\
  J_n' &= \frac{1}{4}N_F D \int_{0}^{\infty} \d\epsilon \re\tr\big[ \epsilon \S{n} (-i\U{I}') \big]
\end{align}
Now, $-i\U{I}'$ refers to either $-i\U{S}'$ or $-i\U{R}'$, which are precisely the terms that we added to the matrix currents $\U{S}$ and $\U{R}$ when we introduced the gauge-covariant derivatives above.
Thus, the conclusion is that even in the presence of spin-orbit coupling, the previously derived equations for the charge, spin, heat, and spin-heat currents hold, if we just straight-forwardly replace regular derivatives with covariant derivatives in the matrix current.





\clearpage
\section{Density of states}
Based on Eschrig's review from 2015 [Eqs.~(47) and (63)], it seems like a reasonable definition of the spin-resolved density of states is ($n=0,\ldots,3$):
\begin{align}
  N_n = \frac{1}{2}N_F \re\tr\big[\S{n} \U{g}^R\big]
\end{align}
In terms of these four coefficients, the density of stated for spins polarized along some direction $\B{\nu}$ would be:
\begin{align}
  N_{\B{\nu}}  = N_F + \B{\nu} \cdot \B{N},
\end{align}
where $\B{N} = (N_1, N_2, N_3)$.
If we average over all $\B\nu$, we get back the usual definition of the spin-independent density of states~$N_F$.
On the other hand, if we let $\B\nu = \pm\B{e}_z$, this reproduces Eqs.~(2.39--40) in I.~Gomperud's thesis for $N_\up$ and $N_\dn$.
Thus, this definition seems consistent with previous results.

\section{Summary}
On the previous pages, I have rewritten all the nonequilibrium observables in terms of only the positive-energy propagators.
This has several benefits.
First of all, every equation except the superconducting gap ended up with being explicitly real quantities, which is a nice quality for an equation that is supposed to represent real physical observables.
Secondly, this means that we only need to solve the Usadel equation for positive energies as before, which saves computation time.
Finally, while the trace-tricks we derived during the project with Tom are nice for recasting the Usadel equation in a numerically suitable form, evaluating e.g. charge and spin currents is actually a bit easier to implement the ``old-fashioned way''.

Interestingly, the cancellations that happened when we rewrote the observables in this way, all lead to the same result: if we just integrate over positive energies, and take twice the real part of that result, we're done.







\clearpage
\section{Accumulation (standard result)}
The presence of nonequilibrium potentials can lead to imbalances in the quasiparticle distributions, which manifest as observable charge, spin, heat, and spin-heat accumulations.
In this section, I will first derive how these imbalances in the quasiparticle distributions can be related to the propagators, and then relate this to the observables discussed above.

There are four relevant species of quasiparticles in the system, namely electrons and holes with two possible spin projections.
Their densities can be written in terms of the spin-resolved creation and annihilation operators,
\begin{align}
  N_{e\up} &\equiv \big\langle \psi_{\up}^\dagger \psi_{\up}^{\phantom{\dagger}} \big\rangle, \\
  N_{e\dn} &\equiv \big\langle \psi_{\dn}^\dagger \psi_{\dn}^{\phantom{\dagger}} \big\rangle, \\
  N_{h\up} &\equiv \big\langle \psi_{\up}^{\phantom{\dagger}} \psi_{\up}^\dagger \big\rangle, \\
  N_{h\dn} &\equiv \big\langle \psi_{\dn}^{\phantom{\dagger}} \psi_{\dn}^\dagger \big\rangle.
\end{align}
Using the notations $\psi_{e\sigma} = \psi_\sigma$ and $\psi_{h\sigma} = \psi^\dagger_\sigma$ for the electron and hole operators, respectively, we can summarize the above as a single equation,
\begin{align}
  N_{\tau\sigma} &\equiv \big\langle \psi_{\tau\sigma}^\dagger \psi_{\tau\sigma}^{\phantom{\dagger}} \big\rangle.
\end{align}
The creation and annihilation operators should in practice be evaluated at the same position~$\B{r}$ and time~$t$.
However, to make sure the derivation is rigorous, I will keep two positions and times during the derivation:
\begin{align}
  N_{\tau\sigma}(\B{r}',t'; \B{r},t) &\equiv \big\langle \psi_{\tau\sigma}^\dagger(\B{r}',t')\, \psi_{\tau\sigma}^{\phantom{\dagger}}(\B{r},t) \big\rangle.
\end{align}

Let us now express the above in terms of non-quasiclassical propagators.
We can write $2AB = \{A, B\} + [A, B]$ for arbitrary operators $A$ and $B$:
\begin{equation}
\begin{aligned}
  2N_{\tau\sigma}
  &=   \big\langle \big\{ \psi_{\tau\sigma}^\dagger(\B{r}',t'),\, \psi_{\tau\sigma}^{\phantom{\dagger}}(\B{r},t) \big\} \big\rangle \\
  &\,+ \big\langle \big[  \psi_{\tau\sigma}^\dagger(\B{r}',t'),\, \psi_{\tau\sigma}^{\phantom{\dagger}}(\B{r},t) \big]  \big\rangle. 
\end{aligned}
\end{equation}
We also know that the step function satisfies $\theta(t-t') + \theta(t'-t) = 1$:
\begin{equation}
\begin{aligned}
  2N_{\tau\sigma}
  &=   \big\langle \big\{ \psi_{\tau\sigma}^\dagger(\B{r}',t'),\, \psi_{\tau\sigma}^{\phantom{\dagger}}(\B{r},t) \big\} \big\rangle \,\theta(t-t') \\
  &\,+ \big\langle \big\{ \psi_{\tau\sigma}^\dagger(\B{r}',t'),\, \psi_{\tau\sigma}^{\phantom{\dagger}}(\B{r},t) \big\} \big\rangle \,\theta(t'-t) \\
  &\,+ \big\langle \big[  \psi_{\tau\sigma}^\dagger(\B{r}',t'),\, \psi_{\tau\sigma}^{\phantom{\dagger}}(\B{r},t) \big]  \big\rangle. 
\end{aligned}
\end{equation}
If we now consult the definitions of the non-quasiclassical propagators [Eq.~(2.12--2.14) in my Master thesis], we see that the above can be written:
\begin{equation}
\begin{aligned}
  2N_{\tau\sigma}
   =& \pm i G^R_{\tau\tau\sigma\sigma}(\B{r}, t; \B{r}', t') \\
    & \mp i G^A_{\tau\tau\sigma\sigma}(\B{r}, t; \B{r}', t') \\
    & \mp i G^K_{\tau\tau\sigma\sigma}(\B{r}, t; \B{r}', t') .
\end{aligned}
\end{equation}
The top signs correspond to $\tau = e$ and the bottom ones to $\tau = h$, and this follows from our definitions of the propagator matrices.%
\footnote{According to Eq.~(2.14) in my Master thesis, the Keldysh propagator for electrons is:
  \begin{equation} \quad G^K_{ee} = +i\big\langle \big[\psi_e^{\dagger}(\B{r}',t'),\,\psi_e^{\phantom\dagger}(\B{r},t) \big] \big\rangle. \end{equation}
  However, Eq.~(2.20) in my thesis shows that $G^K_{hh} \equiv -G^{K\ast}_{ee}$, which implies that:
  \begin{equation} \quad G^K_{hh} = -i\big\langle \big[\psi_e^{\phantom\dagger}(\B{r}',t'),\,\psi_e^{\dagger}(\B{r},t) \big] \big\rangle = -i\big\langle \big[\psi_h^{\dagger}(\B{r}',t'),\,\psi_h^{\phantom\dagger}(\B{r},t) \big] \big\rangle. \end{equation}
  This is why we get different signs for the $G^K$ contributions for electrons and holes. 
  A similar analysis can be done for $G^R$ and $G^A$, although these are less relevant here.}
Explicitly:\\[-3ex]
\begin{align}
  N_{e\up} &= +\frac{i}{2} (G^R_{11} - G^A_{11} - G^K_{11}), \\
  N_{e\dn} &= +\frac{i}{2} (G^R_{22} - G^A_{22} - G^K_{22}), \\
  N_{h\up} &= -\frac{i}{2} (G^R_{33} - G^A_{33} - G^K_{33}), \\
  N_{h\dn} &= -\frac{i}{2} (G^R_{44} - G^A_{44} - G^K_{44}). 
\end{align}

Let us now consider the quasiclassical and dirty limits.
In the same way as we derived Eq.~(3.13) in my Master thesis, we find that:
\begin{equation}
  \underline{\check{G}}(\B{r},t;\B{r},t) &= -\frac{i}{2} N_F \int \d\epsilon\, \underline{\check{g}}(\B{r},t,\epsilon).
\end{equation}
This means that the quasiparticle densities can be written:
\begin{align}
  N_{e\up} &= +\frac{1}{4} N_F (g^R_{11} - g^A_{11} - g^K_{11}), \\
  N_{e\dn} &= +\frac{1}{4} N_F (g^R_{22} - g^A_{22} - g^K_{22}), \\
  N_{h\up} &= -\frac{1}{4} N_F (g^R_{33} - g^A_{33} - g^K_{33}), \\
  N_{h\dn} &= -\frac{1}{4} N_F (g^R_{44} - g^A_{44} - g^K_{44}). 
\end{align}
We also know that $\underline{\hat{g}}^A = -\hat{\tau}_3 \underline{\hat{g}}^{R\dagger} \hat{\tau}_3$:
\begin{align}
  N_{e\up} &= +\frac{1}{4} N_F (g^R_{11} + g^{R\ast}_{11} - g^K_{11}), \\
  N_{e\dn} &= +\frac{1}{4} N_F (g^R_{22} + g^{R\ast}_{22} - g^K_{22}), \\
  N_{h\up} &= -\frac{1}{4} N_F (g^R_{33} + g^{R\ast}_{33} - g^K_{33}), \\
  N_{h\dn} &= -\frac{1}{4} N_F (g^R_{44} + g^{R\ast}_{44} - g^K_{44}). 
\end{align}
At this point, we can recognize the retarded components~$N_F\,\text{Re}[g^R_{\tau\tau\sigma\sigma}]$ as simply the particle- and spin-resolved density of states.
This is purely an equilibrium property, while we are interested in the \emph{nonequilibrium quasiparticle accumulations}. 
We therefore discard the retarded components:%
\footnote{Rammer and Smith makes a similar argument below Eq.~(2.86) in [RMP 58, 323 (1986)]. 
  Specifically, they conclude that ``\emph{The spectral weight $A$ in Eq.~(2.86) represents a contribution to Eqs. (2.84) and (2.85) that does not depend on the state of the system and shall henceforth be dropped when nonequilibrium contributions are considered.}''}%
\footnote{I think we can explain the presence of the $g^R$ terms as follows.
  In equilibrium, we can write $\underline{g}^K = (\underline{g}^R - \underline{g}^A) \tanh(\epsilon/2T)$, and we know that $\underline{g}^A = -\hat{\tau}_3 \underline{g}^{R\ast} \hat{\tau}_3$.
  For the diagonal terms, this implies $g^K = 2\,\text{Re}[g^R]\,\tanh(\epsilon/2T)$. 
  This means that the exact quasiparticle densities in equilibrium are $N = N_F\,\text{Re}[g^R]\,[1-\tanh(\epsilon/2T)]/2$, where $1$ comes from the $g^R$ and $g^A$ terms and $\tanh(\epsilon/2T)$ from the $g^K$ term.
  Here, $[1-\tanh(\epsilon/2T)]/2$ is the Fermi distribution function $f(\epsilon)=1/[1+e^{\epsilon/T}]$, while $h(\epsilon)=\tanh(\epsilon/2T)/2$ is what we call the distribution function in quasiclassical theory.
  Thus, the $g^R$ terms are necessary to calculate a physically correct number of quasiparticles in equilibrium, but as long as we are only interested in nonequilibrium imbalances, they should not affect our results.}%
\begin{align}
  N_{e\up} &= -\frac{1}{4}N_F g^K_{11}, \\
  N_{e\dn} &= -\frac{1}{4}N_F g^K_{22}, \\
  N_{h\up} &= +\frac{1}{4}N_F g^K_{33}, \\
  N_{h\dn} &= +\frac{1}{4}N_F g^K_{44}.
\end{align}
These equations give us all nonequilibrium quasiparticle accumulations in terms of the propagators.

Let us now consider the physical consequences of such quasiparticle accumulations.
Each electron contributes a charge $+e$, and each hole a charge $-e$, where we use $e<0$ as usual.
Thus, the charge imbalance~$\mu_e$ is:
\begin{equation}
  \mu_e \equiv e(N_{e\up} + N_{e\dn} - N_{h\up} - N_{h\dn}).
\end{equation}
Similarly, each spin-up particle contributes a spin $+\hbar/2$, and each spin-down particle a spin $-\hbar/2$.
For their antiparticles, the spin signs are reversed.\footnote{The creation operator for a spin-up hole~$\psi_{h\up}^\dagger$ is the same as the annihilation operator for a spin-up electron~$\psi_{e\up}$. This means that annihilating a spin-up electron should be physically equivalent to creating a spin-up hole. We know that annihilating a spin-up electron gives a change $-\hbar/2$ to the system spin, which is the same as we get by creating a spin-down electron. Thus, spin-up holes and spin-down electrons have the same spin.}
We can therefore define the spin accumulation as:
\begin{equation}
  \mu_\sigma \equiv \frac{\hbar}{2} (N_{e\up} - N_{e\dn} - N_{h\up} + N_{h\dn}).
\end{equation}
Let us now consider the heat accumulation~$\kappa_e$.
The relevant metric is the quasiparticle energy~$\epsilon = E - \mu$ relative to the Fermi level~$\mu$, where $\epsilon > 0$ for electrons and $\epsilon < 0$ for holes.
Neither charge nor spin matters here. Thus:
\begin{equation}
  \kappa_e \equiv \epsilon(N_{e\up} + N_{e\dn} + N_{h\up} + N_{h\dn}).
\end{equation}
Finally, one can make another independent linear combination of the above quasiparticle densities, yielding the so-called spin-heat accumulation:
\begin{equation}
  \kappa_\sigma \equiv \epsilon(N_{e\up} - N_{e\dn} + N_{h\up} - N_{h\dn}).
\end{equation}
Formally, the prefactors~$\epsilon$ above should be added after switching to the mixed representation ($\B{r}\pm\B{r}'$ and $t \pm t'$) and Fourier transforming, but before performing the quasiclassical approximation itself.

If we now combine all the definitions above with the equations for $N_{\tau\sigma}$:
\begin{align}
  \mu_e        &= -\frac{1}{4} N_F \int \d\epsilon \, \,e\,           (g^K_{11} + g^K_{22} + g^K_{33} + g^K_{44}), \\
  \mu_\sigma   &= -\frac{1}{4} N_F \int \d\epsilon \, \frac{\hbar}{2} (g^K_{11} - g^K_{22} + g^K_{33} - g^K_{44}), \\
  \kappa_e      &= -\frac{1}{4} N_F \int \d\epsilon \, \,\epsilon\,    (g^K_{11} + g^K_{22} - g^K_{33} - g^K_{44}), \\
  \kappa_\sigma &= -\frac{1}{4} N_F \int \d\epsilon \, \,\epsilon\,    (g^K_{11} - g^K_{22} - g^K_{33} + g^K_{44}).
\end{align}
Rewriting the above in terms of traces, we finally obtain:
\begin{align}
  \mu_e        &= -\frac{1}{4} N_F \int \d\epsilon \,  \,e\,           \text{Tr}[\hat{\tau}_0 \underline{\sigma}_0 \hat{\underline{g}}^K], \\
  \mu_\sigma   &= -\frac{1}{4} N_F \int \d\epsilon \,  \frac{\hbar}{2} \text{Tr}[\hat{\tau}_0 \underline{\sigma}_3 \hat{\underline{g}}^K], \\
  \kappa_e      &= -\frac{1}{4} N_F \int \d\epsilon \,  \,\epsilon\,    \text{Tr}[\hat{\tau}_3 \underline{\sigma}_0 \hat{\underline{g}}^K], \\
  \kappa_\sigma &= -\frac{1}{4} N_F \int \d\epsilon \,  \,\epsilon\,    \text{Tr}[\hat{\tau}_3 \underline{\sigma}_3 \hat{\underline{g}}^K].
\end{align}
These are in fact the same expressions that we have been using previously, but we now have a justification grounded in the definitions of the propagators.
The only difference is a missing factor $1/2$, which can be attributed to me using $N_F$ as \emph{the density of states per spin} at the Fermi level here, while other authors probably used $N_F$ for the total density of states at the Fermi level.

\clearpage
\section{Accumulation (rigorous result)}
During the derivation on the previous pages, I made the assumption that only terms containing Keldysh propagators are relevant for nonequilibrium quasiparticle accumulations.
This means discarding terms in the quasiparticle densities that were proportional to only the density of states, but that were independent of the distribution function.
This seems like a reasonable assumption, and seems to be quite widespread in the literature, since most authors end up with spectral quantities on the form $\text{Tr}\,[\hat{\tau}_n \underline{\sigma}_m \underline{\hat{g}}^K]$ for the accumulations.
Rammer and Smith mentions this assumption explicitly.

However, after giving it some thought, I am not fully convinced that this remains a reasonable assumption for selfconsistent calculations.
In the non-selfconsistent case, we should be safe: the density of states is purely an equilibrium quantity, so the $\text{Re}[g^R]$ terms cancel when looking at the difference between nonequilibrium and equilibrium quantities.
In the selfconsistent case, it gets more complicated.
Let's say that we consider an S/F system, where we solve selfconsistently in S, and F is a strongly polarized ferromagnet.
Let's also assume that the exchange field in F results in a spin-splitting of the density of states in S via the proximity coupling.
In equilibrium, there is already a spin accumulation (``induced magnetization'') in S, which is caused by the spin-splitting of the density of states, even though the distribution function is spin-independent.
There are now two different ways to produce what we can call a ``nonequilibrium spin accumulation''.
One way would be to inject quasiparticles from F into S, which would change the chemical potentials of spin-up and spin-down quasiparticles differently since F is strongly polarized.
This makes the distribution function~$\underline{\hat{h}}$ spin-dependent, which in turn changes the Keldysh propagator $\underline{\hat{g}}^K$, and is included in the expressions we derived for the accumulations.
However, another way would be to suppress the superconducting gap in S using an arbitrary nonequilibrium potential.
This alters the proximity-coupling between S and F, resulting in a different spin-splitting of the density of states in S.
This should change the ``induced magnetization'' in S, even though the distribution function remains spin-independent.
To accurately model the latter effect, I suspect that we need to include the density of states terms too.

In this section, I will rederive the expressions for the quasiparticle accumulations in a more general form, without making the above assumption.
We can again start with the following definition for the quasiparticle densities:
\begin{align}
  N_{\tau\sigma} &\equiv \big\langle \psi_{\tau\sigma}^\dagger \psi_{\tau\sigma}^{\phantom{\dagger}} \big\rangle.
\end{align}
For generality, we keep two sets of particle coordinates during the derivation:
\begin{align}
  N_{\tau'\tau\sigma'\sigma}(\B{r}',t'; \B{r},t) &\equiv \big\langle \psi_{\tau'\sigma'}^\dagger(\B{r}',t')\, \psi_{\tau\sigma}^{\phantom{\dagger}}(\B{r},t) \big\rangle.
\end{align}
Like before, we can rewrite this in terms of propagators:
\begin{equation}
\begin{aligned}
  2N_{\tau'\tau\sigma'\sigma}(\B{r}, t; \B{r}', t')
   =& \pm i G^R_{\tau\tau'\sigma\sigma'}(\B{r}, t; \B{r}', t') \\
    & \mp i G^A_{\tau\tau'\sigma\sigma'}(\B{r}, t; \B{r}', t') \\
    & \mp i G^K_{\tau\tau'\sigma\sigma'}(\B{r}, t; \B{r}', t') .
\end{aligned}
\end{equation}
Collecting the results in matrix form, we obtain:
\begin{equation}
  \underline{\hat{N}} = \frac{i}{2} \hat{\tau}_3 \big[\underline{\hat{G}}^R - \underline{\hat{G}}^A - \underline{\hat{G}}^K \big].
\end{equation}
The physical quasiparticle densities $N_{e\up}, N_{e\dn}, N_{h\up}, N_{h\dn}$ are then just the diagonal entries in this matrix.
In the quasiclassical and dirty limit we get:
\begin{equation}
  \underline{\hat{N}} = \frac{1}{4} N_F \int\d\epsilon \, \hat{\tau}_3 \big[\underline{\hat{g}}^R - \underline{\hat{g}}^A - \underline{\hat{g}}^K \big].
\end{equation}
We now introduce the distribution function via $\underline{\hat{g}}^K = \underline{\hat{g}}^R \underline{\hat{h}} - \underline{\hat{h}} \underline{\hat{g}}^A$:
\begin{equation}
  \underline{\hat{N}} = \frac{1}{4} N_F \int\d\epsilon \, \hat{\tau}_3 \big[\underline{\hat{g}}^R (1-\underline{\hat{h}}) - (1-\underline{\hat{h}}) \underline{\hat{g}}^A \big].
\end{equation}
We also have the identity $\underline{\hat{g}}^A = -\hat{\tau}_3 \underline{\hat{g}}^{R\dagger} \hat{\tau}_3$, and know that $\hat{\tau}_3$ has to commute with $\underline{\hat{h}}$ when we use the block-diagonal gauge $\underline{\hat{h}} = \text{diag}(+\underline{h},-\underline{\tilde{h}})$:
\begin{equation}
  \underline{\hat{N}} = \frac{1}{4} N_F \int\d\epsilon \, \big[ \hat{\tau}_3 \underline{\hat{g}}^R (1-\underline{\hat{h}}) + (1-\underline{\hat{h}}) \underline{\hat{g}}^{R\dagger} \hat{\tau}_3 \big].
\end{equation}
Now, the accumulation of charge, spin, heat, and spin-heat were determined by calculating $\text{Tr}[\hat{\tau}_n \underline{\sigma}_m \underline{\hat{N}}]$ for different $n$ and $m$.
We then use the cyclic rule:
\begin{equation}
  \mu_{nm} = \frac{1}{4} N_F \int\d\epsilon \, \text{Tr}\big[ \hat{\tau}_n \underline{\sigma}_m \hat{\tau}_3 \underline{\hat{g}}^R (1-\underline{\hat{h}}) + (1-\underline{\hat{h}}) \underline{\hat{g}}^{R\dagger} \hat{\tau}_3 \underline{\sigma}_m \hat{\tau}_n\big].
\end{equation}
Using that everything but $\underline{\hat{g}}^R$ is Hermitian, and the identity $\text{Tr}[A+A^\dagger] = \text{Tr}[A] + \text{Tr}[A]^* = 2\,\text{Re}\,\text{Tr}[A]$, we find the simplified expression:
\begin{equation}
  \mu_{nm} = \frac{1}{2} N_F \int\d\epsilon \, \text{Re}\,\text{Tr}\big[ \hat{\tau}_n \underline{\sigma}_m \hat{\tau}_3 \underline{\hat{g}}^R (1-\underline{\hat{h}}) \big].
\end{equation}
We then set $n=3, m=0$ for charge accumulation, $n=3, m=3$ for spin accumulation, etc. just like before.
\textbf{The remaining question now is: should we use this result in the implementation, or can we argue that there is no contribution from $\underline{\hat{g}}^R-\underline{\hat{g}}^A$ also in selfconsistent nonequilibrium systems? In the latter case, does the argument also hold for energy accumulations?}


\chapter{Physical observables}
\section{Quasiparticle currents}
Let us again start by considering the spin-resolved quasiparticle densities:\
\begin{align}
  \label{eq:density-def-cur-1}
  n_{e\sigma}(\B r, t) &\equiv \avg[\big]{\hc{\psi_\sigma}(\B r,t)\, \pc{\psi_\sigma}(\B r,t)}, \\
  \label{eq:density-def-cur-2}
  n_{h\sigma}(\B r, t) &\equiv \avg[\big]{\pc{\psi_\sigma}(\B r,t)\, \hc{\psi_\sigma}(\B r,t)}.
\end{align}
We will use this to look for quasiparticle continuity equations of the form
\begin{align}
  \label{eq:continuity-def}
  \p t n_{\tau\sigma} +\, \nabla\cdot\B{j}_{\tau\sigma} &= q_{\tau\sigma}, 
\end{align}
where $\B{j}_{\tau\sigma}$ are the quasiparticle currents, and $q_{\tau\sigma}$ refers to possible source terms that generate quasiparticles.
Differentiating \cref{eq:density-def-cur-1,eq:density-def-cur-2}:
\begin{align}
  \label{eq:density-der-cur-1}
  \p t n_{e\sigma} &=
  \avg[\big]{(\p t \hc{\psi_{\sigma}})\, \pc{\psi_{\sigma}}} +
  \avg[\big]{\hc{\psi_{\sigma}}\, (\p t \pc{\psi_{\sigma}})} , \\
  \label{eq:density-der-cur-2}
  \p t n_{h\sigma} &=
  \avg[\big]{(\p t \pc{\psi_{\sigma}})\, \hc{\psi_{\sigma}}} +
  \avg[\big]{\pc{\psi_{\sigma}}\, (\p t \hc{\psi_{\sigma}})} .
\end{align}
We can rewrite the above using the Heisenberg equation of motion for the field operators.
Note that any contributions to the continuity equation arising from non-derivative terms in the Hamiltonian---such as a superconducting gap or an exchange field---cannot produce a contribution of the form~$\nabla\cdot\B{j}$, and can only affect the source term~$q$.
Thus, for the purposes of deriving an expression for the current, it is sufficient to consider only derivative terms.
If we for simplicity disregard gauge fields for now, the equations reduce to:\footnote{These equations follow from writing eq.~(3.27) in J.P.~Morten's thesis in component form and discarding everything but the pure derivative terms. Alternatively, one might do the same procedure with eqs.~(4.12--4.16) in my project thesis, and get the same result.}
\begin{align}
  \p t \hc{\psi_\sigma} &= -\frac{i}{2m} \nabla^2\hc{\psi_\sigma}\,, \\
  \p t \pc{\psi_\sigma} &= +\frac{i}{2m} \nabla^2\pc{\psi_\sigma}\,.
\end{align}
Substituting this into \cref{eq:density-der-cur-1,eq:density-der-cur-2}:
\begin{align}
  \p t n_{e\sigma} &=
  -\frac{i}{2m} 
  \left[ \avg[\big]{(\nabla^2 \hc{\psi_{\sigma}})\, \pc{\psi_{\sigma}}} -
         \avg[\big]{\hc{\psi_{\sigma}}\, (\nabla^2 \pc{\psi_{\sigma}})} \right], \\
  \p t n_{h\sigma} &=
  +\frac{i}{2m} 
  \left[ \avg[\big]{(\nabla^2 \pc{\psi_{\sigma}})\, \hc{\psi_{\sigma}}} -
         \avg[\big]{\pc{\psi_{\sigma}}\, (\nabla^2 \hc{\psi_{\sigma}})} \right]. 
\end{align}
Note that due to a cancellation of cross-terms, this can also be factorized as:
\begin{align}
  \p t n_{e\sigma} &=
  -\frac{i}{2m} \nabla \cdot 
  \left[ \avg[\big]{(\nabla \hc{\psi_{\sigma}})\, \pc{\psi_{\sigma}}} -
         \avg[\big]{\hc{\psi_{\sigma}}\, (\nabla \pc{\psi_{\sigma}})} \right], \\
  \p t n_{h\sigma} &=
  +\frac{i}{2m} \nabla \cdot
  \left[ \avg[\big]{(\nabla \pc{\psi_{\sigma}})\, \hc{\psi_{\sigma}}} -
         \avg[\big]{\pc{\psi_{\sigma}}\, (\nabla \hc{\psi_{\sigma}})} \right].
\end{align}
Comparing this to \cref{eq:continuity-def}, we conclude that the quasiparticle currents:
\begin{align}
  \B{j}_{e\sigma} &\equiv
  +\frac{i}{2m} 
  \left[ \avg[\big]{(\nabla \hc{\psi_{\sigma}})\, \pc{\psi_{\sigma}}} -
         \avg[\big]{\hc{\psi_{\sigma}}\, (\nabla \pc{\psi_{\sigma}})} \right], \\
  \B{j}_{h\sigma} &\equiv
  -\frac{i}{2m}
  \left[ \avg[\big]{(\nabla \pc{\psi_{\sigma}})\, \hc{\psi_{\sigma}}} -
         \avg[\big]{\pc{\psi_{\sigma}}\, (\nabla \hc{\psi_{\sigma}})} \right].
\end{align}
To further simplify our results, we employ a mathematical trick.
Instead of evaluating both quasiparticle operators at the same position and time, we write $\psi_{1 \sigma} \equiv \psi_\sigma(\B{r}_1,t_1)$ and $\psi_{2 \sigma} \equiv \psi_\sigma(\B{r}_2,t_2)$, and will then let $\B{r}_1,\B{r}_2 \rightarrow \B{r}$ and $t_1,t_2 \rightarrow t$ in the final results.
Thus, the above may be rewritten as:
\begin{align}
  \B{j}_{e\sigma} &=
  +\frac{i}{2m} 
  \left[ \avg[\big]{\big(\pc{\nabla_2} \hc{\psi_{2 \sigma}}\big)\, \pc{\psi_{1 \sigma}}} -
  \avg[\big]{\hc{\psi_{2 \sigma}}\, \big(\pc{\nabla_1} \pc{\psi_{1 \sigma}}\big)} \right], \\
  \B{j}_{h\sigma} &=
  -\frac{i}{2m}
  \left[ \avg[\big]{\big(\pc{\nabla_1} \pc{\psi_{1 \sigma}}\big)\, \hc{\psi_{2 \sigma}}} -
  \avg[\big]{\pc{\psi_{1 \sigma}}\, \big(\pc{\nabla_2} \hc{\psi_{2 \sigma}}\big)} \right].
\end{align}
This notation lets us factor the derivatives out of the current density:
\begin{align}
  \B{j}_{e\sigma} &\equiv
  +\frac{i}{2m} \big(\pc{\nabla_2} - \pc{\nabla_1}\big) \,
  \avg[\big]{\hc{\psi_{2 \sigma}}\, \pc{\psi_{1 \sigma}}} ,\\
  \B{j}_{h\sigma} &\equiv
  +\frac{i}{2m} \big(\pc{\nabla_2} - \pc{\nabla_1}\big) \,
  \avg[\big]{\pc{\psi_{1 \sigma}}\, \hc{\psi_{2 \sigma}}} .
\end{align}
As we will see below, this notation makes it very easy to connect these quasiparticle currents to the definitions of the nonequilibrium propagators.

\section{Charge and spin currents}
Regardless of spin, we know that each electron transports a charge~$+e$, while each hole transports the opposite charge~$-e$.
The charge current~$\B{J}_e$ transported by quasiparticles can therefore be defined as:
\begin{equation}
  \B{J}_e \equiv e\big[ +\B{j}_{e\up} + \B{j}_{e\dn} - \B{j}_{h\up} - \B{j}_{h\dn} \big].
\end{equation}
We also know that each electron and hole transports a spin~$\pm\hbar/2$, where we must be careful to keep in mind that spin-up holes actually transport spin-down.
We may therefore similarly define the spin-$z$ current~$\B{J}_z$ as:
\begin{equation}
  \B{J}_z \equiv \frac{\hbar}{2}\big[ +\B{j}_{e\up} - \B{j}_{e\dn} - \B{j}_{h\up} + \B{j}_{h\dn} \big].
\end{equation}
In both cases, the current densities include differences $\B{j}_{e\sigma} - \B{j}_{h\sigma}$ between electron and hole currents, so let us consider these differences a bit closer.\footnote{Intuitively, this makes sense: a positive electron current $+\B{j}_{e\sigma}$ represents electrons flowing to the right, while a hole current $+\B{j}_{h\sigma}$ represents electrons flowing to the left. Thus, the difference $+\B{j}_{e\sigma} - \B{j}_{h\sigma}$ is just the total flow of spin-$\sigma$ electrons to the right, which is the quantity of interest both when considering charge and spin transport.}
Using the results we derived above for the quasiparticle currents, we find:
\begin{align}
  \B{j}_{e\sigma} - \B{j}_{h\sigma} =
  \frac{i}{2m} \big(\pc{\nabla_2} - \pc{\nabla_1}\big) \,
  \avg[\big]{\hc{\psi_{2 \sigma}}\, \pc{\psi_{1 \sigma}} -
             \pc{\psi_{1 \sigma}}\, \hc{\psi_{2 \sigma}}} .
\end{align}
But $-i\avg{ [ \pc{\psi_{1 \sigma}}\,,\, \hc{\psi_{2 \sigma}} ] }$ is just the definition of the Keldysh propagator:
\begin{align}
  \B{j}_{e\sigma} - \B{j}_{h\sigma} =
  \frac{1}{2m} \big(\pc{\nabla_2} - \pc{\nabla_1}\big) \, G^K_{12\sigma\sigma}.
\end{align}
Switching to mixed coordinates $\B{r}_{1,2} \equiv \B{r} \pm \delta\B{r}/2$, and Fourier-transforming the relative coordinate~$\delta\B{r}$, we then get $\nabla_{1,2} \rightarrow \nabla_{\B{r}}/2 \pm i\B{p}$ in the above:
\begin{align}
  \B{j}_{e\sigma} - \B{j}_{h\sigma} =
  -\frac{i\B{p}}{m} \, G^K_{\sigma\sigma}.
\end{align}
We now go back to the definitions of the charge and spin currents:
\begin{align}
  \B{J}_{e} &= -\,e\, \frac{i\B{p}}{m} \big( G^K_{\up\up} + G^K_{\dn\dn} \big), \\
  \B{J}_{z} &= -\frac{\hbar}{2} \frac{i\B{p}}{m} \big( G^K_{\up\up}  - G^K_{\dn\dn} \big).
\end{align}
Generalizing the above to all spin projections, and defining a matrix current
\begin{equation}
  \BU{I}^K \equiv -\frac{i\B{p}}{m}\U{G}^K,
\end{equation}
then the charge and spin currents are all proportional to the current tensor
\begin{align}
  \label{eq:current-tensor-def}
  \B{J}_{i} &\equiv \tr\!\big[\U{\sigma}_i \BU{I}^K \big].
\end{align}
Note that the matrix current defined above is a $2\times2$ quantity in spin space; we did not need to introduce any corresponding structure in Nambu space.



\section{Heat and spin-heat currents}
At zero temperature, all electronic states below the Fermi level are occupied, and all above are unoccupied.
However, at finite temperatures, there are also electron-like excitations above the Fermi level, and hole-like excitations below the Fermi level.
We will denote the energies of the corresponding electronic states as $E = \mu + \epsilon$, where $\epsilon > 0$ for electrons and $\epsilon < 0$ for holes.

Note that both kinds of excitations have a potential energy~$|\epsilon|$.
In the electron case, it is because the excited electron at $E = \mu+|\epsilon|$ can fall down and fill a state at the Fermi level $E = \mu$, and thus liberate an energy~$|\epsilon|$.
In the hole case, it is because an unexcited electron at the Fermi level $E = \mu$ can fall down and fill the hole at $E = \mu-|\epsilon|$, and again liberate an energy~$|\epsilon|$.
When we consider the flow of thermal excitation energy, we therefore conclude that both electrons and holes will give the contribution~$|\epsilon|$.

Let us now define the heat current~$\B{J}_{eh}$ as the flow of excitation energy~$|\epsilon|$.
In terms of the quasiparticle currents $\B{j}_{\tau\sigma}$, this means that we can write:
\begin{equation}
  \B{J}_{eh} \equiv |\epsilon| \big[ +\B{j}_{e\up} + \B{j}_{e\dn} + \B{j}_{h\up} + \B{j}_{h\dn} \big].
\end{equation}
But since $\epsilon > 0$ for electrons and $\epsilon < 0$ for holes, this is equivalent to:
\begin{equation}
  \B{J}_{eh} = \epsilon \big[ +\B{j}_{e\up} + \B{j}_{e\dn} - \B{j}_{h\up} - \B{j}_{h\dn} \big].
\end{equation}
We can similarly define a spin-heat current, which measures the difference in excitation energy flow between the spin species:
\begin{equation}
  \B{J}_{zh} \equiv |\epsilon| \big[ +\B{j}_{e\up} - \B{j}_{e\dn} + \B{j}_{h\up} - \B{j}_{h\dn} \big].
\end{equation}
And we can again rewrite this as just:
\begin{equation}
  \B{J}_{zh} = \epsilon \big[ +\B{j}_{e\up} - \B{j}_{e\dn} - \B{j}_{h\up} + \B{j}_{h\dn} \big].
\end{equation}
Both results involve differences between electron and hole currents, which means that we can reuse the results we derived for the charge and spin currents.
In total, we therefore just find that the spectral heat and spin-heat currents are given by $\epsilon\B{J}_i$, where $\B{J}_i$ is defined in \cref{eq:current-tensor-def}.

\textbf{\textcolor{red}{Question to Jacob: Do you think my definition of heat current is reasonable? What about the above result for the heat current?}}



\section{Gauge corrections}
In systems with electromagnetic or spin-orbit gauge fields, the equations of motion for the field operators also include a first-order derivative term.
Ignoring all other terms in the equation of motion, we get the equations:\footnote{This equation follows from the gauge-covariant Hamiltonian $H = (\nabla-i\B{A})^2/2m$; see e.g. eqs.~(4.12--4.16) in my project thesis, and keep in mind that we always have $\B{A} = \B{A}^\dagger$.}
\begin{align}
  \p t \pc{\psi_\sigma} &= \frac{1}{m} \sum_{\sigma'} \pc{\B{A}_{\sigma\sigma'}} \cdot (\nabla \pc{\psi_{\sigma'}}) \,, \\
  \p t \hc{\psi_\sigma} &= \frac{1}{m} \sum_{\sigma'} (\nabla \hc{\psi_{\sigma'}}) \cdot \pc{\B{A}_{\sigma'\sigma}} \,.
\end{align}
Substituting this into \cref{eq:density-der-cur-1,eq:density-der-cur-2}:
\begin{align}
  \p t n_{e\sigma} &=
  \frac{1}{m} \sum_{\sigma'}
  \left[ 
    \avg[\big]{(\nabla \hc{\psi_{\sigma'}})\, \pc{\psi_{\sigma}}} \cdot \pc{\B{A}_{\sigma'\sigma}} +
    \pc{\B{A}_{\sigma\sigma'}} \cdot \avg[\big]{ \hc{\psi_{\sigma}}\, (\nabla \pc{\psi_{\sigma'}})}
  \right], \\
  \p t n_{h\sigma} &=
  \frac{1}{m} \sum_{\sigma'}
  \left[ 
    \avg[\big]{\pc{\psi_{\sigma}}\, (\nabla \hc{\psi_{\sigma'}})} \cdot \pc{\B{A}_{\sigma'\sigma}} +
    \pc{\B{A}_{\sigma\sigma'}} \cdot \avg[\big]{(\nabla \pc{\psi_{\sigma'}})\, \hc{\psi_{\sigma}}}
  \right]. 
\end{align}
Going back to the quasiparticle continuity, we find the new contributions:
\begin{align}
  \nabla \cdot \B{j}_{e\sigma} &=
  -\frac{1}{m} \sum_{\sigma'}
  \left[ 
    \avg[\big]{(\nabla \hc{\psi_{\sigma'}})\, \pc{\psi_{\sigma}}} \cdot \pc{\B{A}_{\sigma'\sigma}} +
    \pc{\B{A}_{\sigma\sigma'}} \cdot \avg[\big]{ \hc{\psi_{\sigma}}\, (\nabla \pc{\psi_{\sigma'}})}
  \right], \\
  \nabla \cdot \B{j}_{h\sigma} &=
  -\frac{1}{m} \sum_{\sigma'}
  \left[ 
    \avg[\big]{\pc{\psi_{\sigma}}\, (\nabla \hc{\psi_{\sigma'}})} \cdot \pc{\B{A}_{\sigma'\sigma}} +
    \pc{\B{A}_{\sigma\sigma'}} \cdot \avg[\big]{(\nabla \pc{\psi_{\sigma'}})\, \hc{\psi_{\sigma}}}
  \right]. 
\end{align}
We can again introduce two sets of coordinates:
\begin{align}
  \nabla \cdot \B{j}_{e\sigma} &=
  -\frac{1}{m} \sum_{\sigma'}
  \left[ 
    \avg[\big]{ \big( \pc{\nabla_2} \hc{\psi_{2\sigma'}} \big)\, \pc{\psi_{1\sigma}}} \cdot \pc{\B{A}_{\sigma'\sigma}} +
    \pc{\B{A}_{\sigma\sigma'}} \cdot \avg[\big]{ \hc{\psi_{2\sigma}}\, \big( \pc{\nabla_1} \pc{\psi_{1\sigma'}} \big)}
  \right], \\
  \nabla \cdot \B{j}_{h\sigma} &=
  -\frac{1}{m} \sum_{\sigma'}
  \left[ 
    \avg[\big]{\pc{\psi_{1\sigma}}\, (\pc{\nabla_2} \hc{\psi_{2\sigma'}})} \cdot \pc{\B{A}_{\sigma'\sigma}} +
    \pc{\B{A}_{\sigma\sigma'}} \cdot \avg[\big]{(\pc{\nabla_1} \pc{\psi_{1\sigma'}})\, \hc{\psi_{2\sigma}}}
  \right]. 
\end{align}
Pulling the derivatives out of the expectation values:
\begin{align}
  \nabla \cdot \B{j}_{e\sigma} &=
  -\frac{1}{m} \sum_{\sigma'}
  \left[ 
    \pc{\nabla_2} \cdot \avg[\big]{ \hc{\psi_{2\sigma'}} \pc{\psi_{1\sigma}} } \pc{\B{A}_{\sigma'\sigma}} +
    \pc{\nabla_1} \cdot \pc{\B{A}_{\sigma\sigma'}} \avg[\big]{ \hc{\psi_{2\sigma}}\, \pc{\psi_{1\sigma'}} }
  \right], \\
  \nabla \cdot \B{j}_{h\sigma} &=
  -\frac{1}{m} \sum_{\sigma'}
  \left[ 
    \pc{\nabla_2} \cdot \avg[\big]{\pc{\psi_{1\sigma}}\, \hc{\psi_{2\sigma'}}} \pc{\B{A}_{\sigma'\sigma}} +
    \pc{\nabla_1} \cdot \pc{\B{A}_{\sigma\sigma'}} \avg[\big]{\pc{\psi_{1\sigma'}}\, \hc{\psi_{2\sigma}}}
  \right]. 
\end{align}
Subtracting these two currents:
\begin{equation}
  \begin{aligned}
    \nabla \cdot (\B{j}_{e\sigma} - \B{j}_{h\sigma}) = \\
    -\frac{1}{m} \sum_{\sigma'}
    \Big[ 
       \,& \pc{\nabla_2} \cdot \avg[\big]{ \hc{\psi_{2\sigma'}} \pc{\psi_{1\sigma}} - \pc{\psi_{1\sigma}}\, \hc{\psi_{2\sigma'}}} \pc{\B{A}_{\sigma'\sigma}} \\
      +\,& \pc{\nabla_1} \cdot \pc{\B{A}_{\sigma\sigma'}} \avg[\big]{ \hc{\psi_{2\sigma}}\, \pc{\psi_{1\sigma'}} - \pc{\psi_{1\sigma'}}\, \hc{\psi_{2\sigma}}}
    \Big].
  \end{aligned}
\end{equation}
Comparing this to the definition of the Keldysh propagator:
\begin{equation}
    \nabla \cdot (\B{j}_{e\sigma} - \B{j}_{h\sigma}) = 
    +\frac{i}{m} \sum_{\sigma'}
    \big[ 
      \,& \pc{\nabla_2} \cdot G^K_{12\sigma\sigma'} \pc{\B{A}_{\sigma'\sigma}} +\,& \pc{\nabla_1} \cdot \pc{\B{A}_{\sigma\sigma'}} G^K_{12\sigma'\sigma}
    \big].
\end{equation}
We now switch to mixed coordinates, and perform a Fourier transformation of the relative variable, resulting in the net change $\nabla_{1,2} \rightarrow \nabla/2 \pm i\B{p}$.
Since we are looking for current terms $\nabla\cdot\B{j}$ and not source terms $q$, we only keep the terms proportional to $\nabla$, and discard any terms proportional to $\B{p}$.
Thus:
\begin{equation}
    \nabla \cdot (\B{j}_{e\sigma} - \B{j}_{h\sigma}) = 
    +\frac{i}{2m} \nabla \cdot \sum_{\sigma'}
    \big[ 
      \,& G^K_{\sigma\sigma'} \pc{\B{A}_{\sigma'\sigma}} +\,& \pc{\B{A}_{\sigma\sigma'}} G^K_{\sigma'\sigma}
    \big].
\end{equation}
Rewritten in matrix notation, the gauge correction to the current is therefore:
\begin{equation}
  \B{j}_{e\sigma} - \B{j}_{h\sigma} = \frac{i}{2m} \big\{ \U{G}^K ,\, \BU{A} \big\}_{\sigma\sigma}.
\end{equation}
Our previous definitions of charge, spin, heat, and spin-heat currents in terms of the electron and hole currents still stand. 
This gauge correction may therefore be included by simply revising the matrix current:
\begin{equation}
  \BU{I}^K \equiv -\frac{i\B{p}}{m} \U{G}^K + \frac{i}{2m} \big\{ \U{G}^K ,\, \BU{A} \big\} = -\frac{i}{2m} \big\{ \U{G}^K ,\, \B{p} - \BU{A} \big\}.
\end{equation}
This result is only a function of the canonical momentum $\B{p} - \BU{A}$ and therefore manifestly gauge covariant.
In the spin-orbit case, the result above seems to indicate that a spin-orbit field can directly produce a spontaneous spin current in the system.
For instance, if $\BU{A} = -\alpha \B{e}_z \U{\sigma}_z$, then the canonical momentum in the $z$-direction is $p_z\pm\alpha$ depending on spin, which should lead to a spontaneous spin-$z$ current in the $z$-direction.
\textcolor{red}{\textbf{Question to Jacob: based on the physical consequences of this term, is this just a manifestation of ``spin-momentum locking'' in strongly spin-orbit coupled systems? Or do you think that this might be an artifact of the gauge formalism, which is somehow cancelled by the gauge-dependence in the solution $\U{G}^K$?}}

We are interested in the quasiclassical limit, where one might argue that the second term is a higher-order contribution that can be neglected.
Letting $\B{p} \rightarrow \B{p}_F$, we can write the Hamiltonian for a spin-orbit coupled system as
\begin{equation}
  H = \frac{(\B{p}_F - \B{A})^2}{2m} = \frac{\B{p}_F^2}{2m} - \frac{\B{p}_F\cdot\B{A}}{m} + \frac{\B{A}^2}{2m} .
\end{equation}
The first term is just the Fermi energy, the second term is the spin-orbit energy, and the final term is just a constant.\footnote{From the most general spin-orbit field $\B{A} = \sum_{ij} A_{ij} \B{e}_i \U{\sigma}_j$, one can show that ${\B{A}^2 \sim \sigma_0}$, making it independent of spin and direction. If the background field is position-independent as well, as we usually assume for spin-orbit fields, this term has no effects.}
In the quasiclassical limit, the spin-orbit energy must be much smaller than the Fermi energy, from which we conclude that $\|\B{A}\| \ll \|\B{p}_F\|$.
Going back to the matrix current, this means that in the quasiclassical limit $\|\{\U{G}^K,\, \BU{A}\}\| \ll \|\B{p}_F\U{G}^K\|$, and it should be sufficient to include only the leading-order term in the matrix current:
\begin{equation}
  \BU{I}^K \approx -\frac{i\B{p}_F}{m} \U{G}^K .
\end{equation}
\textcolor{red}{\textbf{Question to Jacob: do you agree with this conclusion, i.e. that the anticommutator contribution can be discarded in the quasiclassical limit?}}

%For later convenience, we can also rewrite the above in terms of a velocity~$v \equiv p/m$:
%\begin{equation}
%  \BU{I}^K = -\frac{1}{2}iv \big[ 2\hat{\B{p}} \U{G}^K - v^{-1} \big\{ \U{G}^K ,\, \BU{A} \big\} \big].
%\end{equation}



\section{Quasiclassical and diffusive limits}
When we have a linear function of the propagator~$F(\UV{G})$, and go to the quasiclassical and diffusive limits, the transition can be summarized as:\footnote{There is a factor $1/2$ more in this equation than in my master thesis, because I in my master thesis defined $N_F$ as the density of states \emph{per spin} at the Fermi level.}\footnote{The derivation of this relationship is the same as for eq.~(3.13) in my Master thesis.}
\begin{align}
  F(\UV{G}) \rightarrow -\frac{i}{4}N_F \int\d\epsilon\,\avg[\big]{F(\UV{g})}_F,
\end{align}
where the angle brackets refer to an average over the Fermi surface.
Substituting in the expression for $\BU{I}^K$, and writing $\B{p}_F \equiv mv_F\hat{\B{p}}$, we find that:
\begin{align}
  \BU{I}^K = -\frac{1}{4}N_Fv_F \int\d\epsilon\,\avg[\big]{\hat{\B{p}}\U{g}^K}_F.
\end{align}
We then perform a first-order expansion in momentum $\U{g}^K \equiv \U{g}_s^K + \BU{g}_p^K\cdot\hat{\B{p}}$, and perform the Fermi-surface average over the transport direction $\hat{\B{p}}$:
\begin{align}
  \BU{I}^K = -\frac{1}{12}N_Fv_F \int\d\epsilon\,\BU{g}_p^K.
\end{align}
In the diffusive limit, we can also write $\BUV{g}_p \approx -\tau v_F\UV{g}_s \tc\nabla \UV{g}_s$.\footnote{See the derivation of eq.~(4.95) in my project thesis.}
Extracting the appropriate Nambu and Keldysh components of this equation:
\begin{align}
  \BU{I}^K = +\frac{1}{12}N_F\tau v_F^2 \int\d\epsilon\, \big[ \UV{g}_s\tc\nabla\UV{g}_s \big]^K_{ee}.
\end{align}
Introducing the diffusion constant $D \equiv \tau v_F^2/3$, and dropping the subscripts:
\begin{align}
  \BU{I}^K = \frac{1}{4}N_FD \int\d\epsilon\, \big[ \UV{g}\tc\nabla\UV{g} \big]^K_{ee}.
\end{align}
We may then substitute back the results for $\BU{I}^K$ into the equation for the current tensor~$\B{J}_i$.
Formally, the derivation should be repeated for $\epsilon \BU{I}^K$ for the heat and spin-heat currents, resulting in $\epsilon$ ending up inside the integral.

The above result only involves the electron block $[\cdots]_{ee}$ in Nambu space, and not the hole block $[\cdots]_{hh}$.
However, it does include an integral over both positive and negative energies $\epsilon \in \mathbb{R}$, and this can be used to rewrite the results as integrals over both electron and hole blocks at positive energies:
\begin{align}
  \B{J}_i = \frac{1}{4}N_FD \int_0^\infty \d\epsilon\, \tr \Big\{  \big[\hat{\U\sigma}_i \UV{g}(+\epsilon)\tc\nabla\UV{g}(+\epsilon) \big]^K_{ee} + \big[ \hat{\U\sigma}_i \UV{g}(-\epsilon)\tc\nabla\UV{g}(-\epsilon) \big]^K_{ee} \Big\}.
\end{align}
If we explicitly write out the Nambu-space structure of $\big[ \UV{g}\tc\nabla\UV{g} \big]^K$ in terms of the $2\times2$ retarded, advanced, and Keldysh propagators, we find that the electron--hole symmetries of the integrand implies that we can write:\footnote{\textcolor{red}{Double-check this step. (It was originally checked without the spin-prefactor $\hat{\U{\sigma}}_i$.)}}
\begin{align}
  \B{J}_i = \frac{1}{4}N_FD \int_0^\infty \d\epsilon\, \tr \Big\{ \big[ \hat{\U{\sigma}}_i \UV{g}(+\epsilon)\tc\nabla\UV{g}(+\epsilon) \big]^K_{ee} - \big[ \hat{\U\sigma}_i \UV{g}(+\epsilon)\tc\nabla\UV{g}(+\epsilon) \big]^{K\ast}_{hh} \Big\}.
\end{align}
The current above must necessarily be real, meaning that we can safely take the real part of the current density.\footnote{\textcolor{red}{Is it possible to reach this conclusion without adding~Re manually? This should follow from an inherent energy-symmetry in the integrand, but is not easy to see at a glance.}}
Inside Re, the complex-conjugation of the second term is not important, and can be dropped.
We can therefore rewrite the above as a trace over Nambu and spin space.
In terms of the Pauli matrices $\hat{\tau}_3 = \text{diag}(+1,-1)$ and $\hat{\BU{\sigma}} \equiv \text{diag}(\BU{\sigma},\BU{\sigma}^*)$, we therefore obtain:
\begin{align}
  \B{J}_i = \frac{1}{4}N_FD \int_0^\infty \d\epsilon\, \re\tr \big[ \hat{\tau}_3 \hat{\U{\sigma}}_i  \big( \UV{g}\tc\nabla\UV{g} \big)^K \big].
\end{align}
The exact same analysis can be done for heat and spin-heat currents; but in that case, the energy prefactor~$\epsilon$ also switches sign between positive- and negative-energy contributions to the integral, and we therefore get an extra factor~$\epsilon\hat{\tau}_3$ in the final trace.
The final current densities are thus:
\begin{align}
  \B{J}_e    &= \frac{1}{4}N_FD \int_0^\infty \d\epsilon\, \,e\, \re\tr \big[ \hat{\tau}_3 \hat{\U{\sigma}}_0 \big( \UV{g}\tc\nabla\UV{g} \big)^K \big], \\
  \B{J}_s    &= \frac{1}{4}N_FD \int_0^\infty \d\epsilon\, \frac{\hbar}{2} \re\tr \big[ \hat{\tau}_3 \hat{\BU{\sigma}}  \big( \UV{g}\tc\nabla\UV{g} \big)^K \big], \\
  \B{J}_{eh} &= \frac{1}{4}N_FD \int_0^\infty \d\epsilon\, \,\epsilon\,\re\tr \big[ \hat{\tau}_0 \hat{\U{\sigma}}_0 \big( \UV{g}\tc\nabla\UV{g} \big)^K \big], \\
  \B{J}_{sh} &= \frac{1}{4}N_FD \int_0^\infty \d\epsilon\, \,\epsilon\,\re\tr \big[ \hat{\tau}_0 \hat{\BU{\sigma}} \big( \UV{g}\tc\nabla\UV{g} \big)^K \big].
\end{align}
As usual, one might also use the Drude conductivity $\sigma_0 = e^2N_FD$ to rewrite the prefactors in the current densities when this turns out to be convenient.

\textbf{\textcolor{red}{Note to Jacob: Compared to the standard expressions for the current densities, e.g. equations~(27--30) in \href{https://arxiv.org/abs/1706.08245}{arXiv:1706.08245}, this result is identical except for two differences. One is that we have clarified which currents should have $\hat\tau_0$ and $\hat\tau_3$ in the trace, and verified that it is indeed $\hat{\U{\sigma}}_i = \text{diag}(\U\sigma_i,\U\sigma_i^*)}$ that must appear in the trace. The second is that we have a prefactor $1/4$ and integrate over $(0,+\infty)$, while Bergeret et al. have a prefactor $1/8$ and integrate over $(-\infty, +\infty)$. If we assume that all currents are real, I have previously derived that these two results are identical.}}

